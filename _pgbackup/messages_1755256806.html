<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Messages · Loyalty Console</title>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <style>
    :root{--dt-bg:#f3f5f9;--dt-card:#fff;--dt-text:#0f172a;--dt-muted:#6b7280;--dt-primary:#1f6feb;--dt-border:#e5e7eb;--dt-radius-lg:16px;--dt-shadow:0 8px 24px rgba(15,23,42,.06);--hover:#fafbff;--maxw:1180px;--sidebar-w:240px}
    html,body{height:100%} body{margin:0;background:var(--dt-bg);color:var(--dt-text);font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
    .layout{display:flex;min-height:100vh}
    .sidebar{width:var(--sidebar-w);background:#111827;color:#e5e7eb;position:sticky;top:0;align-self:flex-start;height:100vh;border-right:1px solid #0b1220;display:flex;flex-direction:column}
    .sb-brand{display:flex;align-items:center;gap:.6rem;padding:14px;border-bottom:1px solid rgba(255,255,255,.06);font-weight:700}
    .sb-brand img{width:22px;height:22px;border-radius:6px}
    .sb-nav{padding:10px 8px;display:flex;flex-direction:column;gap:4px}
    .sb-link{display:flex;align-items:center;gap:12px;padding:10px 12px;border-radius:10px;color:#e5e7eb;text-decoration:none;font-weight:600;font-size:.95rem}
    .sb-link:hover{background:#1f2937} .sb-link.active{background:#23314a;color:#fff}
    .sb-footer{margin-top:auto;padding:12px;font-size:.8rem;color:#9ca3af;border-top:1px solid rgba(255,255,255,.06)}
    .main{flex:1;min-width:0;display:flex;flex-direction:column}
    .dt-topbar{background:var(--dt-card);border-bottom:1px solid var(--dt-border);position:sticky;top:0;z-index:1030}
    .tb-inner.container{max-width:calc(var(--maxw)+32px);padding:8px 16px}
    .dt-brand{display:flex;align-items:center;gap:.65rem;font-weight:600}
    .dt-brand img{width:22px;height:22px;border-radius:6px}
    .page{flex:1}.container-narrow{max-width:var(--maxw);margin:0 auto;padding:18px 16px 28px}
    .dt-card{background:var(--dt-card);border:1px solid var(--dt-border);border-radius:var(--dt-radius-lg);box-shadow:var(--dt-shadow)}
    .p-card{padding:16px}@media (min-width:768px){.p-card{padding:18px}}
    .form-control,.form-select,.btn{border-radius:12px}.btn-primary{--bs-btn-bg:var(--dt-primary);--bs-btn-border-color:var(--dt-primary)}
    .preview-card{border:1px dashed var(--dt-border);border-radius:14px;background:#fff}
    .badge-soft{border:1px solid;padding:.3rem .55rem;border-radius:999px;font-weight:700;font-size:.7rem}
    .st-sent{background:#ecfdf5;color:#065f46;border-color:#a7f3d0}.st-scheduled{background:#eff6ff;color:#1e3a8a;border-color:#bfdbfe}.st-failed{background:#fff7ed;color:#9a3412;border-color:#fed7aa}
    @media (max-width:991.98px){.sidebar{position:fixed;left:0;top:0;transform:translateX(-100%);transition:transform .2s ease;z-index:1040}.sidebar.open{transform:translateX(0)}.tb-inner.container{padding-left:56px;padding-right:16px}.burger{display:inline-flex!important}} .burger{display:none}
  </style>
    </head>
    <body>
        <div class="layout">
            <aside class="sidebar" id="sidebar">
                <div class="sb-brand">
                    <img src="images/DataTech.png" alt="DataTech">
                    <span>Loyalty Console</span>
                </div>
                <nav class="sb-nav"><a class="sb-link" href="dashboard.html"><i class="fa-solid fa-gauge-high"></i> Dashboard</a><a class="sb-link" href="orders.html"><i class="fa-solid fa-cart-shopping"></i> Orders</a><a class="sb-link" href="members.html"><i class="fa-solid fa-users"></i> Customers</a><a class="sb-link active" href="messages.html"><i class="fa-solid fa-paper-plane"></i> Messages</a><a class="sb-link" href="reports.html"><i class="fa-solid fa-chart-line"></i> Reports</a><a class="sb-link" href="settings.html"><i class="fa-solid fa-gear"></i> Settings</a><a class="sb-link" href="super-admin.html"><i class="fa-solid fa-user-shield"></i> Super Admin</a><a class="sb-link" href="admin-invite.html"><i class="fa-solid fa-envelope-open-text"></i> Admin Invite</a><a class="sb-link" href="login.html"><i class="fa-solid fa-right-to-bracket"></i> Login</a>
                </nav>
                <div class="sb-footer">© DataTech</div>
            </aside>
            <div class="main">
                <header class="dt-topbar">
                    <div class="tb-inner container d-flex align-items-center justify-content-between">
                        <button class="burger btn btn-outline-secondary btn-sm" id="burger">☰</button>
                        <div class="dt-brand">
                            <img src="images/DataTech.png" alt="DataTech">
                            <span>Loyalty Console</span>
                        </div>
                        <div class="d-flex align-items-center gap-2"></div>
                    </div>
                </header>
                <main class="page">
                    <div class="container-narrow">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div>
                                <h1 class="h5 fw-bold mb-0">Messages</h1>
                                <div class="text-muted small">Compose campaigns and send push via PassKit</div>
                            </div>
                            <div>
                                <button id="btnNewDraft" class="btn btn-outline-secondary btn-sm">New Draft</button>
                            </div>
                        </div>
                        <div class="row g-2">
                            <div class="col-12 col-lg-7">
                                <div class="dt-card p-card">
                                    <h2 class="h6 mb-2">Compose</h2>
                                    <div class="row g-2">
                                        <div class="col-12">
                                            <label class="form-label small">Campaign Name</label>
                                            <input id="cName" class="form-control" placeholder="August Offers">
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <label class="form-label small">Audience</label>
                                            <select id="cAudience" class="form-select">
                                                <option value="all">All Members</option>
                                                <option value="new">Joined in last 30 days</option>
                                                <option value="inactive">No orders in 30 days</option>
                                                <option value="gold">Tier: Gold & Platinum</option>
                                                <option value="custom">Custom segment (CSV)</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-6 d-flex align-items-end">
                                            <div class="form-check">
                                                <input class="form-check-input" type="checkbox" id="cIncludeWallet" checked>
                                                <label class="form-check-label" for="cIncludeWallet">Only Wallet Active</label>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label small">Message</label>
                                            <textarea id="cText" class="form-control" rows="4" placeholder="Describe the offer and CTA…"></textarea>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <label class="form-label small">Image URL (optional)</label>
                                            <input id="cImage" class="form-control" placeholder="https://...">
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <label class="form-label small">Schedule</label>
                                            <input id="cWhen" type="datetime-local" class="form-control">
                                        </div>
                                        <div class="col-6 col-md-3">
                                            <label class="form-label small">UTM Tag</label>
                                            <input id="cUtm" class="form-control" placeholder="august_sale">
                                        </div>
                                        <div class="col-12 d-flex gap-2 mt-1">
                                            <button id="btnPreview" class="btn btn-outline-secondary">Preview</button>
                                            <button id="btnSend" class="btn btn-primary">Send / Schedule</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-5">
                                <div class="dt-card p-card">
                                    <h2 class="h6 mb-2">Preview</h2>
                                    <div class="preview-card p-3">
                                        <div class="d-flex align-items-center gap-2">
                                            <img src="images/DataTech.png" class="rounded" style="width:32px;height:32px" alt="">
                                            <div class="fw-semibold" id="pTitle">August Offers</div>
                                        </div>
                                        <div class="mt-2" id="pText">Your preview will appear here…</div>
                                        <img id="pImage" class="mt-2 d-none" alt="preview" style="max-width:100%;border-radius:12px;border:1px solid var(--dt-border)">
                                        <div class="mt-2 text-muted small" id="pMeta">Audience: All Members</div>
                                    </div>
                                </div>
                                <div class="dt-card p-card mt-2">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">History</h2>
                                        <button id="btnExport" class="btn btn-outline-secondary btn-sm">Export CSV</button>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table align-middle mb-0">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Audience</th>
                                                    <th class="text-end">Sent</th>
                                                    <th class="text-end">Delivered</th>
                                                    <th class="text-end">Opened</th>
                                                    <th class="text-end">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="histBody"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/app-user.js"></script>
        <script>
    (function(){
      if (window.UserSession && !window.UserSession.isAuthenticated()){ sessionStorage.setItem('redirectAfterLogin','messages.html'); location.replace('login.html'); return; }
      const sidebar=document.getElementById('sidebar'), burger=document.getElementById('burger'); burger?.addEventListener('click',()=>sidebar.classList.toggle('open')); sidebar.querySelectorAll('a.sb-link').forEach(a=>a.addEventListener('click',()=>sidebar.classList.remove('open')));
      const HISTORY=[{name:'July Push',audience:'All',sent:4200,delivered:3990,opened:1680,status:'sent'},{name:'VIP Weekend',audience:'Gold/Platinum',sent:620,delivered:602,opened:310,status:'sent'},{name:'Winback 30d',audience:'Inactive 30d',sent:1380,delivered:1275,opened:340,status:'scheduled'},{name:'Oops Fix',audience:'All',sent:4200,delivered:0,opened:0,status:'failed'}];
      function badge(s){return s==='sent'?'<span class="badge-soft st-sent">Sent</span>':s==='scheduled'?'<span class="badge-soft st-scheduled">Scheduled</span>':'<span class="badge-soft st-failed">Failed</span>';}
      function renderHistory(){histBody.innerHTML=HISTORY.map(h=>`<tr><td class="fw-semibold">${h.name}</td><td>${h.audience}</td><td class="text-end">${h.sent.toLocaleString()}</td><td class="text-end">${h.delivered.toLocaleString()}</td><td class="text-end">${h.opened.toLocaleString()}</td><td class="text-end">${badge(h.status)}</td></tr>`).join('');}
      const cName=cNameEl=document.getElementById('cName'),cAudience=document.getElementById('cAudience'),cIncludeWallet=document.getElementById('cIncludeWallet'),cText=document.getElementById('cText'),cImage=document.getElementById('cImage'),cWhen=document.getElementById('cWhen'),cUtm=document.getElementById('cUtm');
      const pTitle=document.getElementById('pTitle'),pText=document.getElementById('pText'),pImage=document.getElementById('pImage'),pMeta=document.getElementById('pMeta'); const histBody=document.getElementById('histBody');
      function updatePreview(){pTitle.textContent=cName.value||'Untitled Campaign'; pText.textContent=cText.value||'Your preview will appear here…'; const img=(cImage.value||'').trim(); if(img){pImage.src=img;pImage.classList.remove('d-none');}else{pImage.classList.add('d-none');} let aud=cAudience.options[cAudience.selectedIndex].text; if(cIncludeWallet.checked) aud+=' · Wallet Active'; pMeta.textContent='Audience: '+aud;}
      ['input','change'].forEach(ev=>[cName,cAudience,cIncludeWallet,cText,cImage].forEach(el=>el.addEventListener(ev,updatePreview)));
      document.getElementById('btnPreview').addEventListener('click',updatePreview);
      document.getElementById('btnNewDraft').addEventListener('click',()=>{cName.value='';cText.value='';cImage.value='';cWhen.value='';cUtm.value='';cAudience.value='all';cIncludeWallet.checked=true;updatePreview();});
      document.getElementById('btnSend').addEventListener('click',()=>{const name=cName.value.trim()||'Untitled Campaign'; const audience=cAudience.options[cAudience.selectedIndex].text+(cIncludeWallet.checked?' · Wallet Active':''); const scheduled=!!cWhen.value; HISTORY.unshift({name,audience,sent:scheduled?0:1000+Math.round(Math.random()*3000),delivered:scheduled?0:900+Math.round(Math.random()*2500),opened:scheduled?0:300+Math.round(Math.random()*1200),status:scheduled?'scheduled':'sent'}); renderHistory(); alert(scheduled?'Scheduled (demo)':'Sent (demo)');});
      document.getElementById('btnExport').addEventListener('click',()=>{const header=['Name','Audience','Sent','Delivered','Opened','Status']; const lines=[header.join(',')].concat(HISTORY.map(h=>[h.name,h.audience,h.sent,h.delivered,h.opened,h.status].map(x=>`"${String(x).replace(/"/g,'""')}"`).join(','))); const blob=new Blob([lines.join('\n')],{type:'text/csv;charset=utf-8;'}); const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='messages-history.csv'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);});
      renderHistory(); updatePreview();
    })();
  </script>
    </body>
</html>