<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Customers · Loyalty Console</title>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    </head>
    <body>
        <div class="layout">
            <aside class="sidebar" id="sidebar">
                <div class="sb-brand">
                    <img src="images/DataTech.png" alt="DataTech">
                    <span class="brand-text">Loyalty Console</span>
                </div>
                <nav class="sb-nav"><a class="sb-link" href="dashboard.html"><i class="fa-solid fa-gauge-high"></i><span class="sb-text">Dashboard</span></a><a class="sb-link" href="orders.html"><i class="fa-solid fa-cart-shopping"></i><span class="sb-text">Orders</span></a><a class="sb-link active" href="members.html"><i class="fa-solid fa-users"></i><span class="sb-text">Customers</span></a><a class="sb-link" href="messages.html"><i class="fa-solid fa-paper-plane"></i><span class="sb-text">Messages</span></a><a class="sb-link" href="reports.html"><i class="fa-solid fa-chart-line"></i><span class="sb-text">Reports</span></a><a class="sb-link" href="settings.html"><i class="fa-solid fa-gear"></i><span class="sb-text">Settings</span></a><a class="sb-link" href="admin.html"><i class="fa-solid fa-user-shield"></i><span class="sb-text">Admin</span></a><a class="sb-link" href="login.html"><i class="fa-solid fa-right-to-bracket"></i><span class="sb-text">Login</span></a>
                </nav>
                <div class="sb-footer">© DataTech 2025</div>
            </aside>
            <div class="main">
                <header class="dt-topbar">
                    <div class="tb-inner container d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center gap-2">
                            <button class="btn-icon burger" id="burger" aria-label="Toggle menu">☰</button>
                            <button class="btn-icon" id="collapseBtn" aria-label="Collapse sidebar">
                                <i class="fa-solid fa-bars"></i>
                            </button>
                        </div>
                        <div></div>
                        <div class="userchip-wrap"></div>
                    </div>
                </header>
                <main class="page">
                    <div class="container-narrow">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div>
                                <h1 class="h5 fw-bold mb-0">Customers</h1>
                                <div class="text-muted small">5% cashback, 1000 pts = 1 KWD</div>
                            </div>
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-outline-secondary btn-sm">
                                    <i class="fa-solid fa-upload me-1"></i>Import / Export
                                </button>
                                <button type="button" class="btn btn-primary btn-sm">
                                    <i class="fa-solid fa-user-plus me-1"></i>Add Customer
                                </button>
                            </div>
                        </div>
                        <div class="dt-card p-card mb-2">
                            <div class="d-flex flex-wrap align-items-center gap-2">
                                <div class="btn-group btn-group-sm" role="group" aria-label="filters">
                                    <button class="btn btn-outline-secondary active" data-filter="all" type="button">All</button>
                                    <button class="btn btn-outline-secondary" data-filter="hasOrders" type="button">Has Orders</button>
                                    <button class="btn btn-outline-secondary" data-filter="negative" type="button">Has Negative Balance</button>
                                    <button class="btn btn-outline-secondary" data-filter="blacklisted" type="button">Blacklisted</button>
                                    <button class="btn btn-outline-secondary" data-filter="deleted" type="button">Deleted</button>
                                </div>
                                <div class="ms-auto d-flex gap-2">
                                    <div class="input-group input-group-sm"><span class="input-group-text bg-white"><i class="fa-solid fa-magnifying-glass"></i></span>
                                        <input class="form-control" id="search" placeholder="Search customers">
                                    </div>
                                    <button class="btn btn-outline-secondary btn-sm" type="button">
                                        <i class="fa-solid fa-filter me-1"></i>Filter
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="dt-card p-card">
                            <div class="table-responsive">
                                <table class="table align-middle mb-0" id="custTable">
                                    <thead>
                                        <tr>
                                            <th style="width:30px;">
                                                <input class="form-check-input" type="checkbox" id="cbAll">
                                            </th>
                                            <th>Name</th>
                                            <th>Phone</th>
                                            <th>Email</th>
                                            <th>Total Orders</th>
                                            <th>Last Order</th>
                                            <th>Account Balance (KWD)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- injected -->
                                    </tbody>
                                </table>
                            </div>
                            <div class="d-flex justify-content-between align-items-center pt-2">
                                <div class="small text-muted" id="custShowing">Showing 1–50 of 27930</div>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-secondary" id="prev" type="button">Previous</button>
                                    <button class="btn btn-outline-secondary" id="next" type="button">Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/app-user.js"></script>
        <script>
(function(){
  try{
    if (window.UserSession && !window.UserSession.isAuthenticated()){
      sessionStorage.setItem('redirectAfterLogin','members.html');
      location.replace('login.html'); return;
    }
  }catch(_){}

  const sidebar = document.getElementById('sidebar');
  document.getElementById('burger')?.addEventListener('click',()=> sidebar.classList.toggle('open'));
  document.getElementById('collapseBtn')?.addEventListener('click',()=> sidebar.classList.toggle('collapsed'));
  sidebar.querySelectorAll('a.sb-link').forEach(a=>a.addEventListener('click',()=> sidebar.classList.remove('open')));

  // Demo customers
  const N = 50;
  const names = ["Mustafa","Reem","Ali","Omar","Sara","Faisal","Maryam","Ruba","Khaled","Zain"];
  const phone = ()=> (Math.floor(Math.random()*900)+100) + " " + (Math.floor(Math.random()*9000)+1000);
  const last = ()=> new Date(Date.now()-Math.random()*5*864e5).toLocaleString([], {month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit'});

  const customers = Array.from({length:N}, (_,i)=>({
    id: i+1,
    name: `${names[i%names.length]} · ${Math.floor(Math.random()*999999)}`,
    phone: phone(),
    email: Math.random()>.7 ? `${names[i%names.length].toLowerCase()}@example.com` : '—',
    orders: Math.floor(Math.random()*3),
    lastOrder: last(),
    // Points converted to KWD (1000 pts = 1KWD). We'll store a KWD balance directly:
    balanceKWD: (Math.random()>.85 ? -1 : 0) + (Math.random()*1.2).toFixed(3)
  }));

  const tbody = document.querySelector('#custTable tbody');
  tbody.innerHTML = customers.map(c=>`
    <tr>
      <td><input class="form-check-input" type="checkbox"></td>
      <td>${c.name}</td>
      <td>${c.phone}</td>
      <td>${c.email}</td>
      <td>${c.orders}</td>
      <td>${c.lastOrder}</td>
      <td>${Number(c.balanceKWD).toFixed(3)}</td>
    </tr>
  `).join('');

  document.getElementById('cbAll').addEventListener('change', (e)=>{
    tbody.querySelectorAll('input[type="checkbox"]').forEach(x=> x.checked = e.target.checked);
  });

  // Filter buttons (demo – no data mutation)
  document.querySelectorAll('[data-filter]').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      document.querySelectorAll('[data-filter]').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      // Here you can implement filtering of "customers" and re-render.
    });
  });
})();
</script>
    </body>
</html>