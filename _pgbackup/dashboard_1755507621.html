<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Dashboard · Members Focus</title>
        <!-- Fonts / Bootstrap / Icons -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <link rel="icon" type="image/x-icon" href="images/datatech-ico.ico">
        <!-- Your styles -->
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/sidebar.css">
        <!-- Charts -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
        <style>
    /* keep charts elegant and not overly tall */
    .chart-wrap{height:260px}
    @media (min-width: 992px){ .chart-wrap{height:300px} }

    /* small helper to align subtle subtitles below H1 */
    .page-sub { color: var(--dt-muted); }
  </style>
    </head>
    <body class="fullpage">
        <div class="layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar" data-include="partials/sidebar.html"></aside>
            <!-- Main -->
            <div class="main">
                <!-- Topbar -->
                <div data-include="partials/topbar.html"></div>
                <!-- Page -->
                <main class="page">
                    <div class="container-narrow">
                        <!-- Title -->
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div>
                                <h1 class="h5 fw-bold mb-0">Members dashboard</h1>
                                <div class="small page-sub">Engagement, growth, and member vs non‑member performance</div>
                            </div>
                            <div class="d-flex gap-2">
                                <a class="btn btn-outline-secondary btn-sm" href="reports.html"> <i class="fa-solid fa-chart-simple me-1"></i>Open Reports </a>
                                <a class="btn btn-primary btn-sm" href="messages.html"> <i class="fa-solid fa-paper-plane me-1"></i>New Campaign </a>
                            </div>
                        </div>
                        <!-- KPIs (members only) -->
                        <div class="row g-2">
                            <div class="col-6 col-lg-3">
                                <div class="kpi">
                                    <div class="label">Total Members</div>
                                    <div class="value" id="kpiMembersTotal">—</div>
                                    <div class="delta up small" id="kpiMembersGrowth">+0% vs prior</div>
                                </div>
                            </div>
                            <div class="col-6 col-lg-3">
                                <div class="kpi">
                                    <div class="label">Active Members (30d)</div>
                                    <div class="value" id="kpiMembersActive">—</div>
                                    <div class="delta up small" id="kpiActiveDelta">+0% vs prior</div>
                                </div>
                            </div>
                            <div class="col-6 col-lg-3">
                                <div class="kpi">
                                    <div class="label">Member Share of Orders (30d)</div>
                                    <div class="value" id="kpiMemberShare">—</div>
                                    <div class="delta up small" id="kpiShareDelta">+0pts vs prior</div>
                                </div>
                            </div>
                            <div class="col-6 col-lg-3">
                                <div class="kpi">
                                    <div class="label">Redemptions (30d)</div>
                                    <div class="value" id="kpiRedemptions">—</div>
                                    <div class="delta down small" id="kpiRedeemDelta">-0% vs prior</div>
                                </div>
                            </div>
                        </div>
                        <!-- Charts: Members vs Non + Growth -->
                        <div class="row g-2 mt-2">
                            <div class="col-12 col-lg-7">
                                <div class="dt-card p-card h-100">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Orders by day (members vs non‑members, 30d)</h2>
                                        <a class="small" href="reports.html#orders">View in Reports</a>
                                    </div>
                                    <div class="chart-wrap">
                                        <canvas id="chartOrdersStacked"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-5">
                                <div class="dt-card p-card h-100">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Member growth (last 30 days)</h2>
                                        <a class="small" href="reports.html#members">View in Reports</a>
                                    </div>
                                    <div class="chart-wrap">
                                        <canvas id="chartMembersGrowth"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Charts: Redemptions split + Payment mix -->
                        <div class="row g-2 mt-2">
                            <div class="col-12 col-lg-5">
                                <div class="dt-card p-card h-100">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Redemptions split</h2>
                                        <span class="small text-muted">Members vs non‑members</span>
                                    </div>
                                    <div class="chart-wrap">
                                        <canvas id="chartRedeemSplit"></canvas>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-7">
                                <div class="dt-card p-card h-100">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Payment mix (members only)</h2>
                                        <span class="small text-muted">Knet / Apple Pay / Wallet</span>
                                    </div>
                                    <div class="chart-wrap">
                                        <canvas id="chartMemberPay"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Recent member activity -->
                        <div class="dt-card p-card mt-2">
                            <div class="d-flex align-items-center justify-content-between mb-1">
                                <h2 class="h6 mb-0">Recent member activity</h2>
                                <a class="small" href="customers.html">View all members</a>
                            </div>
                            <div class="table-responsive">
                                <table class="table align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>Type</th>
                                            <th>Ref</th>
                                            <th>Summary</th>
                                            <th class="text-end">When</th>
                                        </tr>
                                    </thead>
                                    <tbody id="activity"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/dt-include.js"></script>
        <script src="js/sidebar.js" defer></script>
        <script src="js/app-user.js" defer></script>
        <script>
  (function(){
    // ----- Demo data for members vs non-members (30d) -----
    const DAYS=30;
    const labels = Array.from({length:DAYS}, (_,i) => {
      const d = new Date(); d.setDate(d.getDate()-(DAYS-1-i));
      return d.toLocaleDateString([], {month:'short', day:'2-digit'});
    });

    // small helpers
    const rnd = (min,max)=>Math.round(min+(Math.random()*(max-min)));
    const smooth = (base, jitter)=>Array.from({length:DAYS},(_,i)=>Math.max(0, Math.round(base + Math.sin(i/4)*base*0.08 + (Math.random()-0.5)*jitter)));

    // Orders per day
    const ordersMembers = smooth(90, 30);
    const ordersNon     = smooth(120, 35);

    // Member growth series
    const membersAdded = smooth(12,6);
    const cumulative   = membersAdded.reduce((a,v)=>{a.push((a.at(-1)||12482)+v);return a;},[]);

    // KPI figures
    const totalMembers   = cumulative.at(-1);
    const activeMembers  = rnd(3500, 4200); // active last 30d (demo)
    const memberSharePct = Math.round(100 * (ordersMembers.reduce((a,b)=>a+b,0)) / ((ordersMembers.reduce((a,b)=>a+b,0)) + (ordersNon.reduce((a,b)=>a+b,0))));
    const redemptions30d = rnd(620, 820);

    // write KPIs
    document.getElementById('kpiMembersTotal').textContent  = totalMembers.toLocaleString();
    document.getElementById('kpiMembersActive').textContent = activeMembers.toLocaleString();
    document.getElementById('kpiMemberShare').textContent   = memberSharePct + '%';
    document.getElementById('kpiRedemptions').textContent   = redemptions30d.toLocaleString();

    // show some deltas (demo)
    document.getElementById('kpiMembersGrowth').textContent = '+7.2% vs prior';
    document.getElementById('kpiActiveDelta').textContent   = '+3.1% vs prior';
    document.getElementById('kpiShareDelta').textContent    = '+2.4pts vs prior';
    document.getElementById('kpiRedeemDelta').textContent   = '-1.2% vs prior';

    // ----- Charts -----
    // 1) Stacked bar: Orders by day members vs non‑members
    new Chart(document.getElementById('chartOrdersStacked'), {
      type: 'bar',
      data: {
        labels,
        datasets: [
          {label:'Members',    data: ordersMembers, stack:'x'},
          {label:'Non‑members',data: ordersNon,     stack:'x'}
        ]
      },
      options: {
        responsive:true,
        maintainAspectRatio:false,
        plugins:{ legend:{position:'bottom'} },
        scales:{
          x:{ stacked:true },
          y:{ stacked:true, beginAtZero:true }
        }
      }
    });

    // 2) Line: Member growth (cumulative)
    new Chart(document.getElementById('chartMembersGrowth'), {
      type: 'line',
      data: { labels, datasets:[{ label:'Total members', data:cumulative, tension:.35, fill:true }] },
      options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:false}} }
    });

    // 3) Doughnut: Redemptions split
    const redeemMembers = Math.round(redemptions30d * 0.82);
    const redeemNon     = redemptions30d - redeemMembers;
    new Chart(document.getElementById('chartRedeemSplit'), {
      type:'doughnut',
      data:{ labels:['Members','Non‑members'], datasets:[{ data:[redeemMembers, redeemNon] }] },
      options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom' } }, cutout:'60%' }
    });

    // 4) Doughnut: Member payment mix
    const mix = { 'Knet': 48, 'Apple Pay': 27, 'Wallet': 25 };
    new Chart(document.getElementById('chartMemberPay'), {
      type:'doughnut',
      data:{ labels:Object.keys(mix), datasets:[{ data:Object.values(mix) }] },
      options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom' } }, cutout:'55%' }
    });

    // ----- Recent member activity -----
    const ACT=[
      {type:'Signup',  ref:'Noura A.',  summary:'New signup · Green',                 when:'Today 09:10'},
      {type:'Redeem',  ref:'#1765956',  summary:'Mustafa · KWD 5.000 (Wallet)',       when:'Today 08:45'},
      {type:'Message', ref:'August Push',summary:'Sent to Members · 2,410 delivered', when:'Yesterday'},
      {type:'Redeem',  ref:'#1765007',  summary:'Reem · KWD 3.780 (Knet)',            when:'Yesterday'}
    ];
    activity.innerHTML = ACT.map(a=>`
      <tr>
        <td class="fw-semibold">${a.type}</td>
        <td>${a.type==='Redeem'
              ? `<a href="order-details.html?id=${a.ref.replace('#','')}">${a.ref}</a>`
              : a.ref}</td>
        <td>${a.summary}</td>
        <td class="text-end">${a.when}</td>
      </tr>
    `).join('');
  })();
  </script>
    </body>
</html>