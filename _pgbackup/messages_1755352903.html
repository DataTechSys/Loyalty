<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Messages · Loyalty Console</title>
        <!-- Fonts / CSS -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <link rel="icon" type="image/x-icon" href="images/datatech-ico.ico">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/sidebar.css">
    </head>
    <body>
        <div class="layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar" data-include="partials/sidebar.html"></aside>
            <!-- Main -->
            <div class="main">
                <!-- Topbar -->
                <div data-include="partials/topbar.html"></div>
                <!-- Page -->
                <main class="page">
                    <div class="container-narrow">
                        <!-- Title + actions -->
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <h1 class="h5 fw-bold mb-0">Messages</h1>
                            <div class="d-flex align-items-center gap-2">
                                <!-- Date filter -->
                                <input id="msgDate" type="date" class="form-control form-control-sm" style="max-width: 180px">
                                <!-- New campaign --><a href="new-campaign.html" class="btn btn-primary btn-sm px-2 py-1" style="font-size: 0.75rem;"> <i class="fa-solid fa-paper-plane me-1"></i>New Campaign</a>
                            </div>
                        </div>
                        <!-- Table -->
                        <div class="dt-card p-card">
                            <div class="table-responsive">
                                <table class="table align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>Title</th>
                                            <th>Channel</th>
                                            <th>Audience</th>
                                            <th class="text-end">Sent</th>
                                            <th class="text-end">Delivered</th>
                                            <th class="text-end">Date</th>
                                            <th class="text-end">Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="msgBody"></tbody>
                                </table>
                            </div>
                            <div class="d-flex justify-content-between align-items-center mt-2 small text-muted">
                                <div id="msgCount">—</div>
                                <div class="d-flex gap-2">
                                    <button id="resetBtn" class="btn btn-outline-secondary btn-sm"><i class="fa-solid fa-rotate-right me-1"></i>Reset
                                    </button>
                                    <button id="exportBtn" class="btn btn-outline-secondary btn-sm"><i class="fa-solid fa-file-export me-1"></i>Export
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/dt-include.js"></script>
        <script src="js/sidebar.js" defer></script>
        <script src="js/app-user.js" defer></script>
        <script>
      (function(){
        // --- demo rows --------------------------------------------------------
        const rows = [
          { title:'Welcome 5',    channel:'Wallet',   audience:'All customers',      sent:3990, delivered:3890, date:'2025-08-01', status:'Completed' },
          { title:'Weekend Push', channel:'WhatsApp', audience:'Tag: Gold & Silver', sent:1240, delivered:1175, date:'2025-08-10', status:'Completed' },
          { title:'Happy Hour',   channel:'WhatsApp', audience:'Tag: Green',        sent:850,  delivered:790,  date:'2025-08-14', status:'Completed' },
          { title:'August Promo', channel:'Wallet',   audience:'Segment: Inactive',  sent:560,  delivered:532,  date:'2025-08-15', status:'Scheduled' }
        ];

        // --- helpers ----------------------------------------------------------
        const fmt = {
          int:n => Number(n||0).toLocaleString(),
          d: iso => new Date(iso+'T00:00:00').toLocaleString([], {year:'numeric', month:'short', day:'2-digit'})
        };

        const body   = document.getElementById('msgBody');
        const dateIn = document.getElementById('msgDate');
        const count  = document.getElementById('msgCount');
        const reset  = document.getElementById('resetBtn');
        const exportBtn = document.getElementById('exportBtn');

        function render(list){
          body.innerHTML = list.map(r => `
            <tr>
              <td class="fw-semibold">${r.title}</td>
              <td>${r.channel}</td>
              <td>${r.audience}</td>
              <td class="text-end">${fmt.int(r.sent)}</td>
              <td class="text-end">${fmt.int(r.delivered)}</td>
              <td class="text-end">${fmt.d(r.date)}</td>
              <td class="text-end">
                ${badge(r.status)}
              </td>
            </tr>
          `).join('');
          count.textContent = `Showing ${list.length} item${list.length===1?'':'s'}`;
        }

        function badge(status){
          const map = {
            'Completed' : 'success',
            'Scheduled' : 'info',
            'Draft'     : 'secondary',
            'Failed'    : 'danger'
          };
          const tone = map[status] || 'secondary';
          return `<span class="badge text-bg-${tone}">${status}</span>`;
        }

        function applyFilter(){
          const d = dateIn.value; // yyyy-mm-dd or ''
          if(!d){ render(rows); return; }
          const filtered = rows.filter(r => r.date === d);
          render(filtered);
        }

        // wire
        dateIn.addEventListener('change', applyFilter);
        reset.addEventListener('click', () => { dateIn.value=''; render(rows); });

        exportBtn.addEventListener('click', ()=>{
          // quick CSV export of the current table
          const trs = [...body.querySelectorAll('tr')];
          const header = ['Title','Channel','Audience','Sent','Delivered','Date','Status'];
          const lines = [header.join(',')].concat(
            trs.map(tr => [...tr.children].map(td => `"${td.innerText.replace(/"/g,'""')}"`).join(','))
          );
          const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8;'});
          const url  = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url; a.download = 'messages.csv';
          document.body.appendChild(a); a.click(); a.remove();
          URL.revokeObjectURL(url);
        });

        // initial
        render(rows);
      })();
    </script>
    </body>
</html>