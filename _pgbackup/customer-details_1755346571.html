<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Customer Details · Loyalty Console</title>
        <!-- Fonts + Bootstrap + Icons -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <link rel="icon" type="image/x-icon" href="images/datatech-ico.ico">
        <!-- Your app styles -->
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/sidebar.css">
        <style>
      /* small page-only sugar */
      .avatar-lg{
        width:64px;height:64px;border-radius:50%;
        background:#e8eefc;border:1px solid #cfe0ff;
        display:inline-flex;align-items:center;justify-content:center;
        font-weight:700;color:#39557a;
        overflow:hidden;
      }
      .chip {border:1px solid var(--dt-border); border-radius:999px; padding:.25rem .55rem; font-weight:600; font-size:.75rem;}
      .chip.success{background:#ecfdf5;color:#065f46;border-color:#a7f3d0}
      .chip.warn{background:#fff7ed;color:#9a3412;border-color:#fed7aa}
      .chip.muted{background:#f3f5f9;color:#4b5563}
      .table tr td .muted{color:#6b7280}
    </style>
    </head>
    <body>
        <div class="layout">
            <!-- Sidebar include -->
            <aside class="sidebar" id="sidebar" data-include="partials/sidebar.html"></aside>
            <!-- Main -->
            <div class="main">
                <!-- Topbar include -->
                <div data-include="partials/topbar.html"></div>
                <!-- Page -->
                <main class="page">
                    <div class="container-narrow">
                        <!-- Header row -->
                        <div class="d-flex align-items-start justify-content-between mb-2">
                            <div class="d-flex align-items-center gap-3"><a href="customers.html" class="btn btn-outline-secondary btn-sm"> <i class="fa-solid fa-angle-left me-1"></i> Back </a>
                                <div>
                                    <div class="d-flex align-items-center gap-2">
                                        <div id="custAvatar" class="avatar-lg">CU</div>
                                        <div>
                                            <h1 class="h5 fw-bold mb-0" id="custTitle">Customer · —</h1>
                                            <div class="text-muted small" id="custSubtitle">Customer profile, history and PassKit membership</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="fa-solid fa-id-badge me-1"></i> Enable Loyalty
                                </button>
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="fa-regular fa-credit-card me-1"></i> Enable House Account
                                </button><a href="customers.html" class="btn btn-primary btn-sm"><i class="fa-solid fa-pen-to-square me-1"></i> Edit Customer</a>
                            </div>
                        </div>
                        <!-- KPI row -->
                        <div class="row g-2 mb-2">
                            <div class="col-12 col-lg-3">
                                <div class="dt-card p-card h-100">
                                    <div class="text-muted small">Done Orders</div>
                                    <div class="display-6 fw-bold" id="kpiOrders">0</div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-3">
                                <div class="dt-card p-card h-100">
                                    <div class="text-muted small">Total Spent (KWD)</div>
                                    <div class="display-6 fw-bold" id="kpiSpent">0</div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-3">
                                <div class="dt-card p-card h-100">
                                    <div class="text-muted small">Total Discounts (KWD)</div>
                                    <div class="display-6 fw-bold" id="kpiDiscounts">0</div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-3">
                                <div class="dt-card p-card h-100">
                                    <div class="d-flex align-items-center justify-content-between">
                                        <div>
                                            <div class="text-muted small">Wallet Balance (KWD)</div>
                                            <div class="display-6 fw-bold" id="kpiWallet">0.000</div>
                                        </div><span id="walletType" class="chip muted">Wallet</span>
                                    </div>
                                    <div class="text-muted small mt-1" id="walletPts">— pts</div>
                                </div>
                            </div>
                        </div>
                        <!-- quick facts -->
                        <div class="row g-2 mb-2">
                            <div class="col-12 col-lg-4">
                                <div class="dt-card p-card h-100">
                                    <div class="text-muted small">Last Order</div>
                                    <div id="lastOrder" class="fw-semibold">—</div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-4">
                                <div class="dt-card p-card h-100">
                                    <div class="text-muted small">Favourite Product</div>
                                    <div id="favProduct" class="fw-semibold">—</div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-4">
                                <div class="dt-card p-card h-100">
                                    <div class="text-muted small">Favourite Branch</div>
                                    <div id="favBranch" class="fw-semibold">—</div>
                                </div>
                            </div>
                        </div>
                        <!-- Profile block -->
                        <div class="dt-card p-card mb-2">
                            <div class="row g-2">
                                <div class="col-12 col-lg-6">
                                    <div class="text-muted small">Name</div>
                                    <div id="f_name" class="mb-2">—</div>
                                    <div class="text-muted small">Phone</div>
                                    <div id="f_phone" class="mb-2">—</div>
                                    <div class="text-muted small">Loyalty</div>
                                    <div id="f_loyalty" class="mb-2">—</div>
                                    <div class="text-muted small">Blacklist</div>
                                    <div id="f_blacklist" class="mb-2">—</div>
                                </div>
                                <div class="col-12 col-lg-6">
                                    <div class="text-muted small">Email</div>
                                    <div id="f_email" class="mb-2">—</div>
                                    <div class="text-muted small">Birth Date</div>
                                    <div id="f_birth" class="mb-2">—</div>
                                    <div class="text-muted small">House Accounts</div>
                                    <div id="f_house" class="mb-2">—</div>
                                </div>
                            </div>
                        </div>
                        <!-- PassKit Membership -->
                        <div class="dt-card p-card mb-2">
                            <div class="d-flex align-items-center justify-content-between mb-1">
                                <h2 class="h6 mb-0">Membership (PassKit)</h2>
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="fa-solid fa-arrows-rotate me-1"></i> Change Tier
                                </button>
                            </div>
                            <div class="row g-2">
                                <div class="col-12 col-lg-3">
                                    <div class="text-muted small">Tier</div>
                                    <div id="m_tier" class="fw-semibold">—</div>
                                </div>
                                <div class="col-12 col-lg-3">
                                    <div class="text-muted small">Member Since</div>
                                    <div id="m_since" class="fw-semibold">—</div>
                                </div>
                                <div class="col-12 col-lg-3">
                                    <div class="text-muted small">Expiry</div>
                                    <div id="m_expiry" class="fw-semibold">—</div>
                                </div>
                                <div class="col-12 col-lg-3">
                                    <div class="text-muted small">Wallet Pass Type</div>
                                    <div id="m_walletType" class="fw-semibold">—</div>
                                </div>
                            </div>
                        </div>
                        <!-- Points history -->
                        <div class="dt-card p-card mb-2">
                            <div class="d-flex align-items-center justify-content-between mb-1">
                                <h2 class="h6 mb-0">Points History</h2>
                                <div class="text-muted small">1000 pts = KWD 1.000</div>
                            </div>
                            <div class="table-responsive">
                                <table class="table align-middle">
                                    <thead>
                                        <tr>
                                            <th>When</th>
                                            <th>Type</th>
                                            <th class="text-end">Points</th>
                                            <th class="text-end">KWD</th>
                                            <th>Note</th>
                                        </tr>
                                    </thead>
                                    <tbody id="pointsBody"></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Coupons -->
                        <div class="dt-card p-card mb-2">
                            <div class="d-flex align-items-center justify-content-between mb-1">
                                <h2 class="h6 mb-0">Coupons</h2>
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="fa-solid fa-ticket me-1"></i> Send Coupon
                                </button>
                            </div>
                            <div class="table-responsive">
                                <table class="table align-middle">
                                    <thead>
                                        <tr>
                                            <th>Code</th>
                                            <th>Title</th>
                                            <th class="text-end">Value (KWD)</th>
                                            <th>Status</th>
                                            <th>Sent</th>
                                            <th>Redeemed</th>
                                            <th>Expires</th>
                                        </tr>
                                    </thead>
                                    <tbody id="couponsBody"></tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Messages (campaigns) -->
                        <div class="dt-card p-card">
                            <div class="d-flex align-items-center justify-content-between mb-1">
                                <h2 class="h6 mb-0">Messages</h2>
                            </div>
                            <div class="table-responsive">
                                <table class="table align-middle">
                                    <thead>
                                        <tr>
                                            <th>Title</th>
                                            <th>Channel</th>
                                            <th>Sent</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody id="messagesBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/dt-include.js"></script>
        <script src="js/sidebar.js" defer></script>
        <script src="js/app-user.js" defer></script>
        <script>
      // ---------- DEMO DATA / helpers (replace with real API later) ----------
      (function(){
        // read id from ?id=
        const params = new URLSearchParams(location.search);
        const custId = params.get('id') || '738868';

        // demo customer object
        const CUST = {
          id: custId,
          name: 'Noura Alazzaz',
          phone: '+965 9793 5543',
          email: '',
          birth: '1997-08-21',
          loyaltyEnabled: false,
          blacklisted: false,
          houseAccounts: false,
          avatar: '', // if present, show photo; otherwise initials
          favProduct: '—',
          favBranch: '—',
          lastOrder: '—',
          kpi: { orders: 0, spent: 0.000, discounts: 0.000, walletKwd: 3.200, walletPts: 3200, walletType: 'Apple Wallet' },
          membership: { tier: 'Green', since: '12/09/2024', expiry: '12/09/2026', walletType: 'Apple Wallet' },
          points: [
            { when:'14 Aug 2025, 12:35', type:'Earn',   pts:+150, kwd:+0.150, note:'Order #1765956'},
            { when:'10 Aug 2025, 16:10', type:'Redeem', pts:-200, kwd:-0.200, note:'Redeemed at POS'},
            { when:'01 Aug 2025, 11:05', type:'Earn',   pts:+230, kwd:+0.230, note:'Order #1764899'},
          ],
          coupons: [
            { code:'WELCOME5', title:'Welcome 5', kwd:0.500, status:'Redeemed', sent:'01 Jul 2025, 12:00', redeemed:'05 Jul 2025, 16:11', expires:'01 Oct 2025' },
            { code:'BDAY10',   title:'Birthday 10', kwd:1.000, status:'Sent',     sent:'20 Aug 2025, 09:00', redeemed:'—',                    expires:'20 Sep 2025' },
            { code:'WEEKEND',  title:'Weekend 3',   kwd:0.300, status:'Expired',  sent:'10 Jun 2025, 10:00', redeemed:'—',                    expires:'10 Jul 2025' }
          ],
          messages: [
            { title:'July Push', channel:'Push / Wallet', sent:'Yesterday', status:'Delivered' },
            { title:'Weekend Promo', channel:'SMS',       sent:'Last week', status:'Delivered'  },
            { title:'Survey Invite', channel:'Email',     sent:'Last month', status:'Opened' }
          ]
        };

        const fmtKWD = v => 'KWD ' + Number(v).toFixed(3).replace(/\B(?=(\d{3})+(?!\d))/g, ',');
        const chip = (txt, kind='muted') => `<span class="chip ${kind}">${txt}</span>`;

        // Title + avatar
        document.getElementById('custTitle').textContent = `${CUST.name} - ${CUST.id}`;
        document.getElementById('custSubtitle').textContent = 'Customer profile, history and PassKit membership';

        const av = document.getElementById('custAvatar');
        if (CUST.avatar){
          av.innerHTML = `<img src="${CUST.avatar}" alt="" style="width:100%;height:100%;object-fit:cover">`;
        } else {
          const initials = CUST.name.split(' ').map(w=>w[0]).slice(0,2).join('').toUpperCase();
          av.textContent = initials || 'CU';
        }

        // KPIs
        document.getElementById('kpiOrders').textContent = CUST.kpi.orders;
        document.getElementById('kpiSpent').textContent  = fmtKWD(CUST.kpi.spent);
        document.getElementById('kpiDiscounts').textContent = fmtKWD(CUST.kpi.discounts);
        document.getElementById('kpiWallet').textContent = Number(CUST.kpi.walletKwd).toFixed(3);
        document.getElementById('walletType').textContent = CUST.kpi.walletType;
        document.getElementById('walletPts').textContent  = `${CUST.kpi.walletPts.toLocaleString()} pts`;

        // quick facts
        document.getElementById('lastOrder').textContent = CUST.lastOrder;
        document.getElementById('favProduct').textContent = CUST.favProduct;
        document.getElementById('favBranch').textContent  = CUST.favBranch;

        // profile fields
        document.getElementById('f_name').textContent      = `${CUST.name} - ${CUST.id}`;
        document.getElementById('f_phone').textContent     = CUST.phone || '—';
        document.getElementById('f_loyalty').textContent   = CUST.loyaltyEnabled ? 'Enabled' : 'Disabled';
        document.getElementById('f_blacklist').textContent = CUST.blacklisted ? 'Yes' : 'No';
        document.getElementById('f_email').textContent     = CUST.email || '—';
        document.getElementById('f_birth').textContent     = CUST.birth || '—';
        document.getElementById('f_house').textContent     = CUST.houseAccounts ? 'Enabled' : 'Disabled';

        // membership
        document.getElementById('m_tier').textContent       = CUST.membership.tier;
        document.getElementById('m_since').textContent      = CUST.membership.since;
        document.getElementById('m_expiry').textContent     = CUST.membership.expiry;
        document.getElementById('m_walletType').textContent = CUST.membership.walletType;

        // points
        const pb = document.getElementById('pointsBody');
        pb.innerHTML = CUST.points.map(p => `
          <tr>
            <td>${p.when}</td>
            <td>${p.type}</td>
            <td class="text-end ${p.pts<0?'text-danger':'text-success'}">${p.pts>0?'+':''}${p.pts.toLocaleString()}</td>
            <td class="text-end ${p.kwd<0?'text-danger':'text-success'}">${p.kwd>0?'+':''}${Number(p.kwd).toFixed(3)}</td>
            <td class="muted">${p.note}</td>
          </tr>
        `).join('');

        // coupons
        const cb = document.getElementById('couponsBody');
        const statusChip = s => {
          if (s==='Redeemed') return chip('Redeemed','success');
          if (s==='Expired')  return chip('Expired','warn');
          return chip('Sent','muted');
        };
        cb.innerHTML = CUST.coupons.map(c => `
          <tr>
            <td>${c.code}</td>
            <td>${c.title}</td>
            <td class="text-end">${Number(c.kwd).toFixed(3)}</td>
            <td>${statusChip(c.status)}</td>
            <td>${c.sent}</td>
            <td>${c.redeemed}</td>
            <td>${c.expires}</td>
          </tr>
        `).join('');

        // messages
        const mb = document.getElementById('messagesBody');
        mb.innerHTML = CUST.messages.map(m => `
          <tr>
            <td>${m.title}</td>
            <td>${m.channel}</td>
            <td>${m.sent}</td>
            <td>${m.status}</td>
          </tr>
        `).join('');
      })();
    </script>
    </body>
</html>