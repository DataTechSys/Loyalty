<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Orders · Loyalty Console</title>
        <!-- Fonts + Bootstrap + Icons -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    </head>
    <body>
        <div class="layout">
            <!-- Sidebar (loaded dynamically) -->
            <aside class="sidebar" data-include="partials/sidebar.html"></aside>
            <!-- Main -->
            <div class="main">
                <!-- Topbar (kept minimal; user chip on the right) -->
                <header class="dt-topbar">
                    <div class="tb-inner container d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center gap-2">
                            <button class="btn-icon burger" id="burger" aria-label="Toggle menu">☰</button>
                            <button class="btn-icon" id="collapseBtn" aria-label="Collapse sidebar"><i class="fa-solid fa-bars"></i>
                            </button>
                        </div>
                        <div class="flex-grow-1"></div>
                        <div class="d-flex align-items-center gap-2 userchip-wrap">
                            <!-- filled by app-user.js -->
                        </div>
                    </div>
                </header>
                <!-- Page -->
                <main class="page">
                    <div class="container-narrow">
                        <!-- Title + actions -->
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div>
                                <h1 class="h5 fw-bold mb-0">Orders</h1>
                                <div class="text-muted small">Recent orders</div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-secondary btn-sm" id="exportCsv">
                                    <i class="fa-solid fa-file-arrow-down me-1"></i>Export CSV
                                </button><a class="btn btn-outline-secondary btn-sm" href="reports.html"><i class="fa-solid fa-chart-simple me-1"></i>Open Reports</a>
                            </div>
                        </div>
                        <!-- Filters -->
                        <div class="row g-2 mb-2">
                            <div class="col-12 col-md-3">
                                <select class="form-select" id="fltRange">
                                    <option value="30">Last 30 days</option>
                                    <option value="7">Last 7 days</option>
                                    <option value="1">Today</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-3">
                                <select class="form-select" id="fltPay">
                                    <option value="">All payment types</option>
                                    <option value="Knet">Knet</option>
                                    <option value="Apple Pay">Apple Pay</option>
                                    <option value="Cash">Cash</option>
                                    <option value="Card">Card</option>
                                    <option value="Loyalty">Loyalty</option>
                                </select>
                            </div>
                            <div class="col-12 col-md-4">
                                <input id="fltSearch" class="form-control" placeholder="search by customer or #order…">
                            </div>
                            <div class="col-12 col-md-2 d-grid d-md-block">
                                <button class="btn btn-outline-secondary w-100" id="fltReset">Reset</button>
                            </div>
                        </div>
                        <!-- Table -->
                        <div class="dt-card p-card">
                            <div class="table-responsive">
                                <table class="table align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>Order</th>
                                            <th>Customer</th>
                                            <th>When</th>
                                            <th>Payment</th>
                                            <th class="text-end">Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ordBody">
                                        <tr>
                                            <td colspan="5" class="text-muted">Loading…</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="d-flex justify-content-end gap-2 mt-2">
                                <button class="btn btn-outline-secondary btn-sm" id="prev">Previous</button>
                                <button class="btn btn-outline-secondary btn-sm" id="next">Next</button>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/dt-include.js"></script>
        <script src="js/sidebar.js" defer></script>
        <script src="js/app-user.js" defer></script>
        <script>
  // Demo data + render (payment types instead of paid/unpaid/refunded)
  (function(){
    const rows = [
      {id:1770355, cust:'Mark Christopher', when:'Aug 16, 08:05', pay:'Knet',      amount:1.400},
      {id:1770220, cust:'Reem',             when:'Aug 16, 07:51', pay:'Apple Pay', amount:3.780},
      {id:1769988, cust:'Ali',              when:'Aug 15, 23:10', pay:'Loyalty',   amount:2.600},
      {id:1769901, cust:'Sara',             when:'Aug 15, 21:03', pay:'Cash',      amount:1.950},
      {id:1769810, cust:'Mo',               when:'Aug 15, 19:40', pay:'Card',      amount:4.200},
    ];

    const fmtKWD = v => 'KWD ' + Number(v).toFixed(3);
    const body = document.getElementById('ordBody');

    function render(list){
      body.innerHTML = list.map(r => `
        <tr>
          <td><a href="order-details.html?id=${r.id}">#${r.id}</a></td>
          <td>${r.cust || '-'}</td>
          <td>${r.when}</td>
          <td>${r.pay}</td>
          <td class="text-end">${fmtKWD(r.amount)}</td>
        </tr>
      `).join('');
    }

    // simple filtering demo
    const fltPay = document.getElementById('fltPay');
    const fltSearch = document.getElementById('fltSearch');
    const fltReset = document.getElementById('fltReset');

    function applyFilters(){
      const q = (fltSearch.value||'').toLowerCase();
      const p = fltPay.value;
      const out = rows.filter(r => {
        const okPay = !p || r.pay === p;
        const okQ = !q || (String(r.id).includes(q) || (r.cust||'').toLowerCase().includes(q));
        return okPay && okQ;
      });
      render(out);
    }

    fltPay.addEventListener('change', applyFilters);
    fltSearch.addEventListener('input', applyFilters);
    fltReset.addEventListener('click', () => { fltPay.value=''; fltSearch.value=''; applyFilters(); });

    // initial
    render(rows);

    // CSV export demo
    document.getElementById('exportCsv').addEventListener('click', ()=>{
      const header = ['Order','Customer','When','Payment','Amount'];
      const lines = [header.join(',')].concat(
        rows.map(r => [r.id, r.cust, r.when, r.pay, r.amount].map(x => `"${String(x).replace(/"/g,'""')}"`).join(','))
      );
      const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8;'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='orders.csv';
      document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    });
  })();
  </script>
    </body>
</html>