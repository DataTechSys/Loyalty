<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Settings · Loyalty Console</title>
        <!-- Fonts / Bootstrap / Icons -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <!-- Your theme -->
        <link rel="icon" type="image/x-icon" href="images/datatech-ico.ico">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/sidebar.css">
        <style>
    .form-hint{color:#6b7280;font-size:.85rem}
    .chip-pill{border:1px solid var(--dt-border);background:#fff;border-radius:999px;padding:.25rem .55rem;font-weight:600}
    .section-title{font-weight:700}
    .counter{font-variant-numeric: tabular-nums;}
  </style>
    </head>
    <body>
        <div class="layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar" data-include="partials/sidebar.html"></aside>
            <!-- Main -->
            <div class="main">
                <!-- Topbar -->
                <div data-include="partials/topbar.html"></div>
                <!-- Page -->
                <main class="page">
                    <div class="container-narrow">
                        <!-- Header -->
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div>
                                <h1 class="h5 fw-bold mb-0">Settings</h1>
                                <div class="text-muted small">Configure loyalty behaviour and defaults.</div>
                            </div>
                            <div class="d-flex gap-2">
                                <!-- Quick links (visible based on role in real app) --><a href="admin.html" class="btn btn-outline-secondary btn-sm"> <i class="fa-solid fa-user-gear me-1"></i> Admin </a><a href="super-admin.html" class="btn btn-outline-secondary btn-sm"> <i class="fa-solid fa-shield-halved me-1"></i> Super Admin </a>
                            </div>
                        </div>
                        <form id="loyaltySettingsForm" class="row g-2">
                            <!-- Loyalty settings card -->
                            <div class="col-12">
                                <div class="dt-card p-card">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0 section-title">Loyalty</h2>
                                    </div>
                                    <div class="row g-3">
                                        <!-- Reward % -->
                                        <div class="col-12 col-md-6">
                                            <label class="form-label">Reward percentage on purchase</label>
                                            <div class="input-group">
                                                <input type="number" step="0.5" min="0" max="50" class="form-control" id="rewardPct" placeholder="e.g. 5"><span class="input-group-text">%</span>
                                            </div>
                                            <div class="form-hint">Customers earn this % of the purchase value as points.</div>
                                        </div>
                                        <!-- Expiry months -->
                                        <div class="col-12 col-md-6">
                                            <label class="form-label">Reward expiry (from day of earn)</label>
                                            <select class="form-select" id="rewardExpiryMonths">
                                                <option value="1">1 month</option>
                                                <option value="3" selected>3 months</option>
                                                <option value="6">6 months</option>
                                                <option value="9">9 months</option>
                                                <option value="12">12 months</option>
                                            </select>
                                            <div class="form-hint">When earned points will expire.</div>
                                        </div>
                                        <!-- Reminder before expiry -->
                                        <div class="col-12 col-md-6">
                                            <label class="form-label">Send reminder before points expiry</label>
                                            <select id="reminders" class="form-select" multiple>
                                                <option value="7d" selected>7 days before</option>
                                                <option value="14d">14 days before</option>
                                                <option value="1m" selected>1 month before</option>
                                            </select>
                                            <div class="form-hint">Hold ⌘/Ctrl to select multiple reminders.</div>
                                        </div>
                                        <!-- Reminder text -->
                                        <div class="col-12">
                                            <label class="form-label">Reminder message</label>
                                            <textarea id="reminderMsg" rows="3" class="form-control" maxlength="200">Use your Points before they get Expired.</textarea>
                                            <div class="d-flex justify-content-between">
                                                <div class="form-hint">This is sent via PassKit when a reminder triggers.</div>
                                                <div class="form-hint">
                                                    <span id="msgCount" class="counter">0</span>/200
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Campaigns & Coupons -->
                            <div class="col-12">
                                <div class="dt-card p-card">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0 section-title">Coupons & Birthdays</h2>
                                    </div>
                                    <div class="row g-3">
                                        <!-- Birthday coupon expiry -->
                                        <div class="col-12 col-md-6">
                                            <label class="form-label">Birthday coupon expiry</label>
                                            <select class="form-select" id="bdayExpiry">
                                                <option value="2">2 days</option>
                                                <option value="5" selected>5 days</option>
                                                <option value="7">1 week</option>
                                                <option value="14">2 weeks</option>
                                            </select>
                                            <div class="form-hint">How long a birthday coupon is valid after it’s issued.</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Wallet behaviour -->
                            <div class="col-12">
                                <div class="dt-card p-card">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0 section-title">Wallet (PassKit)</h2>
                                    </div>
                                    <div class="row g-3">
                                        <!-- Days before wallet removal -->
                                        <div class="col-12 col-md-6">
                                            <label class="form-label">Days before inactive wallet is removed</label>
                                            <div class="input-group">
                                                <input type="number" min="0" class="form-control" id="walletRemovalDays" placeholder="e.g. 90"><span class="input-group-text">days</span>
                                            </div>
                                            <div class="form-hint">
                                                Wallet will be removed from the customer’s phone, but <strong>all data will be preserved</strong>.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Actions -->
                            <div class="col-12 d-flex gap-2">
                                <button class="btn btn-primary" type="submit"><i class="fa-solid fa-floppy-disk me-1"></i> Save changes
                                </button>
                                <button class="btn btn-outline-secondary" type="button" id="btnReset"><i class="fa-solid fa-rotate-left me-1"></i> Reset to defaults
                                </button>
                            </div>
                        </form>
                    </div>
                </main>
            </div>
        </div>
        <!-- JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/dt-include.js"></script>
        <script src="js/sidebar.js" defer></script>
        <script src="js/app-user.js" defer></script>
        <!-- Inline page logic (demo persistence via localStorage) -->
        <script>
    (function(){
      const KEY = 'loyaltySettings.v1';

      const els = {
        form: document.getElementById('loyaltySettingsForm'),
        rewardPct: document.getElementById('rewardPct'),
        rewardExpiryMonths: document.getElementById('rewardExpiryMonths'),
        reminders: document.getElementById('reminders'),
        reminderMsg: document.getElementById('reminderMsg'),
        msgCount: document.getElementById('msgCount'),
        bdayExpiry: document.getElementById('bdayExpiry'),
        walletRemovalDays: document.getElementById('walletRemovalDays'),
        btnReset: document.getElementById('btnReset'),
      };

      function load(){
        const s = JSON.parse(localStorage.getItem(KEY) || 'null') || {
          rewardPct: 5,
          rewardExpiryMonths: 3,
          reminders: ['7d','1m'],
          reminderMsg: 'Use your Points before they get Expired.',
          bdayExpiry: 5,
          walletRemovalDays: 90
        };
        els.rewardPct.value = s.rewardPct;
        els.rewardExpiryMonths.value = String(s.rewardExpiryMonths);
        // Multi-select
        Array.from(els.reminders.options).forEach(o => o.selected = s.reminders.includes(o.value));
        els.reminderMsg.value = s.reminderMsg || '';
        els.msgCount.textContent = els.reminderMsg.value.length;
        els.bdayExpiry.value = String(s.bdayExpiry);
        els.walletRemovalDays.value = s.walletRemovalDays;
      }

      function save(e){
        e?.preventDefault?.();
        const reminders = Array.from(els.reminders.selectedOptions).map(o => o.value);
        const payload = {
          rewardPct: Math.max(0, Number(els.rewardPct.value || 0)),
          rewardExpiryMonths: Number(els.rewardExpiryMonths.value || 3),
          reminders,
          reminderMsg: String(els.reminderMsg.value || '').slice(0,200),
          bdayExpiry: Number(els.bdayExpiry.value || 5),
          walletRemovalDays: Math.max(0, Number(els.walletRemovalDays.value || 0))
        };
        localStorage.setItem(KEY, JSON.stringify(payload));
        // small toast-like feedback
        const btn = e?.submitter;
        if (btn){
          btn.disabled = true; btn.innerHTML = '<i class="fa-solid fa-check me-1"></i> Saved';
          setTimeout(()=>{ btn.disabled=false; btn.innerHTML='<i class="fa-solid fa-floppy-disk me-1"></i> Save changes'; }, 900);
        }
      }

      // Live counter for message
      els.reminderMsg.addEventListener('input', () => {
        if (els.reminderMsg.value.length > 200) {
          els.reminderMsg.value = els.reminderMsg.value.slice(0,200);
        }
        els.msgCount.textContent = els.reminderMsg.value.length;
      });

      els.form.addEventListener('submit', save);
      els.btnReset.addEventListener('click', () => {
        localStorage.removeItem(KEY);
        load();
      });

      load();
    })();
  </script>
    </body>
</html>