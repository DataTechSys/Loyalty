<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Reports · Loyalty Console</title>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    </head>
    <body>
        <div class="layout">
            <aside class="sidebar" id="sidebar">
                <div class="sb-brand">
                    <img src="images/DataTech.png" alt="DataTech">
                    <span class="brand-text">Loyalty Console</span>
                </div>
                <nav class="sb-nav"><a class="sb-link" href="dashboard.html"><i class="fa-solid fa-gauge-high"></i><span class="sb-text">Dashboard</span></a><a class="sb-link" href="orders.html"><i class="fa-solid fa-cart-shopping"></i><span class="sb-text">Orders</span></a><a class="sb-link" href="members.html"><i class="fa-solid fa-users"></i><span class="sb-text">Customers</span></a><a class="sb-link" href="messages.html"><i class="fa-solid fa-paper-plane"></i><span class="sb-text">Messages</span></a><a class="sb-link active" href="reports.html"><i class="fa-solid fa-chart-line"></i><span class="sb-text">Reports</span></a><a class="sb-link" href="settings.html"><i class="fa-solid fa-gear"></i><span class="sb-text">Settings</span></a><a class="sb-link" href="admin.html"><i class="fa-solid fa-user-shield"></i><span class="sb-text">Admin</span></a><a class="sb-link" href="login.html"><i class="fa-solid fa-right-to-bracket"></i><span class="sb-text">Login</span></a>
                </nav>
                <div class="sb-footer">© DataTech 2025</div>
            </aside>
            <div class="main">
                <header class="dt-topbar">
                    <div class="tb-inner container d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center gap-2">
                            <button class="btn-icon burger" id="burger" aria-label="Toggle menu">☰</button>
                            <button class="btn-icon" id="collapseBtn" aria-label="Collapse sidebar">
                                <i class="fa-solid fa-bars"></i>
                            </button>
                        </div>
                        <div></div>
                        <div class="userchip-wrap"></div>
                    </div>
                </header>
                <main class="page">
                    <div class="container-narrow">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div>
                                <h1 class="h5 fw-bold mb-0">Reports</h1>
                                <div class="text-muted small">Revenue, orders, customers, and loyalty performance</div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-secondary btn-sm" type="button">
                                    <i class="fa-solid fa-download me-1"></i>Export
                                </button>
                            </div>
                        </div>
                        <div class="row g-2">
                            <div class="col-12 col-lg-7">
                                <div class="dt-card p-card h-100">
                                    <h2 class="h6 mb-1">Revenue (90 days)</h2>
                                    <canvas id="rev90" height="160"></canvas>
                                </div>
                            </div>
                            <div class="col-12 col-lg-5">
                                <div class="dt-card p-card h-100">
                                    <h2 class="h6 mb-1">Orders (90 days)</h2>
                                    <canvas id="ord90" height="160"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="row g-2 mt-2">
                            <div class="col-12 col-lg-5">
                                <div class="dt-card p-card h-100">
                                    <h2 class="h6 mb-1">Payment Types</h2>
                                    <canvas id="payTypes" height="200"></canvas>
                                </div>
                            </div>
                            <div class="col-12 col-lg-7">
                                <div class="dt-card p-card h-100">
                                    <h2 class="h6 mb-1">Top Customers (KWD)</h2>
                                    <div class="table-responsive">
                                        <table class="table align-middle mb-0">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Orders</th>
                                                    <th class="text-end">Spend</th>
                                                </tr>
                                            </thead>
                                            <tbody id="tops"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/app-user.js"></script>
        <script>
(function(){
  try{
    if (window.UserSession && !window.UserSession.isAuthenticated()){
      sessionStorage.setItem('redirectAfterLogin','reports.html');
      location.replace('login.html'); return;
    }
  }catch(_){}

  const sidebar = document.getElementById('sidebar');
  document.getElementById('burger')?.addEventListener('click',()=> sidebar.classList.toggle('open'));
  document.getElementById('collapseBtn')?.addEventListener('click',()=> sidebar.classList.toggle('collapsed'));
  sidebar.querySelectorAll('a.sb-link').forEach(a=>a.addEventListener('click',()=> sidebar.classList.remove('open')));

  // Charts demo
  const DAYS=90;
  const labels = Array.from({length:DAYS}, (_,i)=> {
    const d = new Date(); d.setDate(d.getDate()-(DAYS-1-i));
    return d.toLocaleDateString([], {month:'short', day:'2-digit'});
  });
  const jitter = (n,base,spread)=>Array.from({length:n},(_,i)=>Math.max(0, base + Math.sin(i/5)*base*.05 + (Math.random()-.5)*spread));
  const revenue = jitter(DAYS, 260, 90).map(v=>+v.toFixed(2));
  const orders  = jitter(DAYS, 80, 30).map(v=>Math.round(v));

  new Chart(document.getElementById('rev90'), {
    type:'line',
    data:{ labels, datasets:[{label:'Revenue', data:revenue, fill:true, tension:.35}]},
    options:{ plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
  });

  new Chart(document.getElementById('ord90'), {
    type:'bar',
    data:{ labels, datasets:[{label:'Orders', data:orders}]},
    options:{ plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
  });

  // Payment types (for cafe): Knet, Apple Pay, Loyalty
  new Chart(document.getElementById('payTypes'), {
    type:'doughnut',
    data:{ labels:['Knet','Apple Pay','Loyalty'], datasets:[{ data:[54, 34, 12] }]},
    options:{ plugins:{legend:{position:'bottom'}}, cutout:'60%' }
  });

  // Top customers table
  const tops = [
    {n:'Mustafa', o:12, s:86.500},
    {n:'Reem',    o:10, s:71.200},
    {n:'Ali',     o:9,  s:64.750},
    {n:'Omar',    o:7,  s:48.100},
    {n:'Sara',    o:6,  s:41.330},
  ];
  document.getElementById('tops').innerHTML = tops.map(t=>`
    <tr><td class="fw-semibold">${t.n}</td><td>${t.o}</td><td class="text-end">KWD ${t.s.toFixed(3)}</td></tr>
  `).join('');
})();
</script>
    </body>
</html>