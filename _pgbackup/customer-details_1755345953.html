<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Customer Details · Loyalty Console</title>
        <!-- Fonts + Bootstrap + Icons -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <link rel="icon" type="image/x-icon" href="images/datatech-ico.ico">
        <!-- App CSS -->
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/sidebar.css">
    </head>
    <body>
        <div class="layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar" data-include="partials/sidebar.html"></aside>
            <!-- Main -->
            <div class="main">
                <!-- Topbar -->
                <div data-include="partials/topbar.html"></div>
                <!-- Page -->
                <main class="page">
                    <div class="container-narrow">
                        <!-- Header -->
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <h1 class="h5 fw-bold mb-0">Customer Details</h1><a href="customers.html" class="btn btn-sm btn-outline-secondary"> <i class="fa-solid fa-arrow-left me-1"></i> Back to Customers </a>
                        </div>
                        <!-- Customer Info Card -->
                        <div class="dt-card p-card mb-3">
                            <div class="d-flex align-items-center gap-3">
                                <img id="custAvatar" src="images/avatar-placeholder.png" class="rounded-circle" width="64" height="64" alt="Customer">
                                <div>
                                    <h5 id="custName" class="mb-1">Loading...</h5>
                                    <div class="small text-muted"><span id="custPhone"></span> · <span id="custEmail"></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Orders -->
                        <div class="dt-card p-card mb-3">
                            <h6 class="fw-bold mb-2">Orders</h6>
                            <div class="table-responsive">
                                <table class="table align-middle table-sm">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Date</th>
                                            <th>Status</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="custOrders">
                                        <tr>
                                            <td colspan="4" class="text-center text-muted small">No orders found</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- Balance -->
                        <div class="dt-card p-card">
                            <h6 class="fw-bold mb-2">Account Balance</h6>
                            <p class="mb-0" id="custBalance">Loading...</p>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/dt-include.js"></script>
        <script src="js/sidebar.js" defer></script>
        <script src="js/app-user.js" defer></script>
        <script>
      (function(){
        // Demo customers (same IDs as customers.html)
        const customers = [
          {id:1, name:'Ruba - 911804', phone:'504 42505', email:'—', points:0, orders:[
            {id:101, date:'Aug 13, 10:09am', status:'Completed', total:'KWD 1.200'}
          ]},
          {id:2, name:'Mark Christopher - 285', phone:'—', email:'—', points:2800, orders:[
            {id:201, date:'Aug 13, 12:48pm', status:'Completed', total:'KWD 2.800'}
          ]},
          {id:3, name:'Kamran Mansoor - 312198', phone:'9937 9160', email:'—', points:15000, orders:[
            {id:301, date:'Aug 14, 08:56am', status:'Completed', total:'KWD 15.000'},
            {id:302, date:'Aug 14, 09:30am', status:'Cancelled', total:'KWD 0.000'}
          ]},
        ];

        // Read ID from query string
        const params = new URLSearchParams(window.location.search);
        const custId = parseInt(params.get("id"));
        const cust = customers.find(c => c.id === custId);

        if(cust){
          custName.textContent = cust.name;
          custPhone.textContent = cust.phone || '—';
          custEmail.textContent = cust.email || '—';
          custBalance.textContent = "KWD " + (cust.points/1000).toFixed(3);

          // Orders
          if(cust.orders && cust.orders.length > 0){
            custOrders.innerHTML = cust.orders.map(o=>`
              <tr>
                <td>${o.id}</td>
                <td>${o.date}</td>
                <td>${o.status}</td>
                <td>${o.total}</td>
              </tr>
            `).join('');
          }
        } else {
          custName.textContent = "Customer not found";
          custPhone.textContent = "—";
          custEmail.textContent = "—";
          custBalance.textContent = "—";
        }
      })();
    </script>
    </body>
</html>