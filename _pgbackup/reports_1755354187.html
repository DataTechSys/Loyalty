<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Reports · Loyalty Console</title>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <link rel="icon" type="image/x-icon" href="images/datatech-ico.ico">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/sidebar.css">
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    </head>
    <body class="fullpage">
        <div class="layout">
            <aside class="sidebar" id="sidebar" data-include="partials/sidebar.html"></aside>
            <div class="main">
                <div data-include="partials/topbar.html"></div>
                <main class="page">
                    <div class="container-narrow">
                        <!-- Title + filters -->
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div>
                                <h1 class="h5 fw-bold mb-0">Reports</h1>
                                <div class="text-muted small">Sales, orders, payments, and loyalty performance</div>
                            </div>
                        </div>
                        <div class="d-flex flex-wrap align-items-center gap-2 mb-2 filters-row">
                            <select class="form-select form-select-sm" aria-label="Branches">
                                <option selected>All Branches</option>
                                <option>Branch AHB | Abu Halifa</option>
                                <option>Branch SLB | Salmiya</option>
                                <option>Branch JRB | Jahra</option>
                            </select>
                            <select class="form-select form-select-sm" aria-label="Range">
                                <option selected>Last 30 days</option>
                                <option>Today</option>
                                <option>Yesterday</option>
                                <option>Last 7 days</option>
                                <option>Last 90 days</option>
                                <option>This month</option>
                            </select>
                            <div class="ms-auto d-flex gap-2">
                                <button class="btn btn-outline-secondary btn-sm"><i class="fa-solid fa-file-export me-1"></i>Export
                                </button>
                                <button class="btn btn-outline-secondary btn-sm"><i class="fa-solid fa-rotate-right me-1"></i>Reset
                                </button>
                                <button class="btn btn-outline-secondary btn-sm"><i class="fa-solid fa-filter me-1"></i>Filter
                                </button>
                            </div>
                        </div>
                        <!-- Cards / charts -->
                        <div class="row g-2">
                            <div class="col-12 col-xl-6">
                                <div class="dt-card p-card chart-tile">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Revenue (90 days)</h2>
                                    </div>
                                    <canvas id="repRevenue"></canvas>
                                </div>
                            </div>
                            <div class="col-12 col-xl-6">
                                <div class="dt-card p-card chart-tile">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Orders (90 days)</h2>
                                    </div>
                                    <canvas id="repOrders"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="row g-2 mt-2">
                            <div class="col-12 col-xl-4">
                                <div class="dt-card p-card chart-tile">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Payments Mix</h2>
                                    </div>
                                    <canvas id="repPayments"></canvas>
                                </div>
                            </div>
                            <div class="col-12 col-xl-8">
                                <div class="dt-card p-card chart-tile">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Members (90 days)</h2>
                                    </div>
                                    <canvas id="repMembers"></canvas>
                                </div>
                            </div>
                        </div>
                        <!-- Logs table (as requested) -->
                        <div class="dt-card p-card mt-2">
                            <div class="d-flex align-items-center justify-content-between mb-1">
                                <h2 class="h6 mb-0">Logs</h2><small class="text-muted">Recent actions & system events</small>
                            </div>
                            <div class="table-responsive">
                                <table class="table align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>When</th>
                                            <th>User</th>
                                            <th>Event</th>
                                            <th>Details</th>
                                        </tr>
                                    </thead>
                                    <tbody id="logsBody"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/dt-include.js"></script>
        <script src="js/sidebar.js" defer></script>
        <script src="js/app-user.js" defer></script>
        <script>
  (function(){
    const N=90;
    const labels = Array.from({length:N},(_,i)=> {
      const d=new Date(); d.setDate(d.getDate()-(N-1-i));
      return d.toLocaleDateString([],{month:'short',day:'2-digit'});
    });
    const rnd = (n,base,j)=>Array.from({length:n},(_,i)=>Math.max(0, base + (Math.sin(i/5)*base*0.06) + (Math.random()-0.5)*j));

    const rev = rnd(N,220,90).map(v=>+v.toFixed(2));
    const ord = rnd(N,75,30).map(v=>Math.round(v));
    const mem = rnd(N,10,5).map(v=>Math.max(0,Math.round(v)));

    new Chart(document.getElementById('repRevenue'),{
      type:'line',
      data:{labels, datasets:[{label:'Revenue', data:rev, fill:true, tension:.35}]},
      options:{responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
    });

    new Chart(document.getElementById('repOrders'),{
      type:'bar',
      data:{labels, datasets:[{label:'Orders', data:ord}]},
      options:{responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
    });

    new Chart(document.getElementById('repPayments'),{
      type:'doughnut',
      data:{labels:['Knet','Apple Pay','Cash','Loyalty','Card'], datasets:[{data:[40,20,16,12,12]}]},
      options:{responsive:true, plugins:{legend:{position:'bottom'}}, cutout:'60%'}
    });

    new Chart(document.getElementById('repMembers'),{
      type:'line',
      data:{labels, datasets:[{label:'New Members', data:mem, tension:.35, fill:true}]},
      options:{responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}}}
    });

    // Logs (demo)
    const LOGS=[
      {when:'Today 10:12', user:'Demo Admin', event:'Campaign Sent', detail:'July Promo to All (3,990)'},
      {when:'Today 09:47', user:'Demo Admin', event:'Order Refunded', detail:'#1765007 · KWD 3.780'},
      {when:'Yesterday',   user:'System',     event:'Import',        detail:'Members CSV (410 new)'},
    ];
    logsBody.innerHTML = LOGS.map(l=>`
      <tr>
        <td>${l.when}</td><td>${l.user}</td><td>${l.event}</td><td>${l.detail}</td>
      </tr>`).join('');
  })();
  </script>
    </body>
</html>