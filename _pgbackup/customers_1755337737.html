<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Customers · Loyalty Console</title>
        <!-- Fonts + Bootstrap + Icons -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <!-- Your styles -->
        <link rel="stylesheet" href="../css/sidebar.css">
        <link rel="stylesheet" href="../css/style.css">
    </head>
    <body>
        <div class="layout">
            <!-- Sidebar include -->
            <aside class="sidebar" id="sidebar"></aside>
            <!-- Main -->
            <div class="main">
                <!-- Topbar include -->
                <header class="dt-topbar" id="topbar"></header>
                <main class="page">
                    <div class="container-narrow">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div>
                                <h1 class="h5 fw-bold mb-0">Customers</h1>
                                <div class="text-muted small">All enrolled customers, spend and wallet balance</div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-outline-secondary btn-sm">
                                    <i class="fa-solid fa-file-export me-1"></i>Export CSV
                                </button><a class="btn btn-primary btn-sm" href="messages.html"><i class="fa-solid fa-paper-plane me-1"></i>Send Campaign</a>
                            </div>
                        </div>
                        <!-- Filters -->
                        <div class="dt-card p-card mb-2">
                            <div class="row g-2 align-items-center">
                                <div class="col-12 col-md-3">
                                    <label class="form-label small mb-1">Date range</label>
                                    <select id="fRange" class="form-select form-select-sm">
                                        <option value="30">Last 30 days</option>
                                        <option value="90" selected>Last 90 days</option>
                                        <option value="365">Last 12 months</option>
                                        <option value="all">All time</option>
                                    </select>
                                </div>
                                <div class="col-12 col-md-3">
                                    <label class="form-label small mb-1">Branch</label>
                                    <select id="fBranch" class="form-select form-select-sm">
                                        <option value="">All branches</option>
                                        <option>AHB | Abu Halifa</option>
                                        <option>Salmiya</option>
                                        <option>Jabriya</option>
                                    </select>
                                </div>
                                <div class="col-12 col-md-3">
                                    <label class="form-label small mb-1">Status</label>
                                    <select id="fStatus" class="form-select form-select-sm">
                                        <option value="">Any</option>
                                        <option value="loyalty-on">Loyalty Enabled</option>
                                        <option value="blacklisted">Blacklisted</option>
                                    </select>
                                </div>
                                <div class="col-12 col-md-3">
                                    <label class="form-label small mb-1">Search</label>
                                    <input id="fSearch" class="form-control form-control-sm" placeholder="Search name, phone, email…">
                                </div>
                            </div>
                        </div>
                        <!-- Table -->
                        <div class="dt-card p-card">
                            <div class="table-responsive">
                                <table class="table align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Phone</th>
                                            <th>Email</th>
                                            <th class="text-end">Total Orders</th>
                                            <th>Last Order</th>
                                            <th class="text-end">Wallet (KWD)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="custBody"></tbody>
                                </table>
                            </div>
                            <div class="d-flex justify-content-between align-items-center pt-2">
                                <div class="small text-muted" id="rowsInfo">Showing 0</div>
                                <div class="btn-group btn-group-sm">
                                    <button class="btn btn-outline-secondary" id="prevBtn" disabled>Previous</button>
                                    <button class="btn btn-outline-secondary" id="nextBtn" disabled>Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- Bootstrap -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Your helpers -->
        <script src="../js/dt-include.js"></script>
        <script src="../js/app-user.js"></script>
        <script>
    // Include sidebar & topbar
    dtInclude('#sidebar', 'sidebar.html', { onDone: markActive });
    dtInclude('#topbar', 'topbar.html');

    function markActive(){
      const here = location.pathname.split('/').pop().toLowerCase();
      document.querySelectorAll('.sidebar a.sb-link').forEach(a=>{
        const href = (a.getAttribute('href')||'').split('/').pop().toLowerCase();
        if (href === 'customers.html' || href === here) a.classList.add('active');
      });
    }

    // Demo dataset
    const DATA = [
      { id:'738868', name:'Noura Alazzaz', phone:'+965 9793 5543', email:'', orders:0, last:'—', wallet:3.200 },
      { id:'530923', name:'MOHAMMD ALRASHIDI', phone:'507 55772', email:'', orders:1, last:'Aug 13, 06:49pm', wallet:1.750 },
      { id:'294077', name:'bader ben awadh', phone:'9917 9977', email:'', orders:1, last:'Aug 13, 08:15am', wallet:0.200 },
      { id:'312198', name:'Kamran Mansoor', phone:'9937 9160', email:'', orders:2, last:'Aug 14, 08:56am', wallet:0.000 },
      { id:'911804', name:'Ruba', phone:'504 42505', email:'', orders:1, last:'Aug 13, 10:09am', wallet:0.000 }
    ];

    // Simple pager
    let page = 0, size = 10;
    function fmtKWD(v){ return 'KWD ' + Number(v).toLocaleString(undefined,{minimumFractionDigits:3, maximumFractionDigits:3}); }

    function render(){
      const body = document.getElementById('custBody');
      const start = page*size;
      const end = Math.min(DATA.length, start+size);
      const rows = DATA.slice(start, end).map(c => `
        <tr>
          <td><a href="customer-details.html?id=${c.id}">${c.name} - ${c.id}</a></td>
          <td>${c.phone || '—'}</td>
          <td>${c.email || '—'}</td>
          <td class="text-end">${c.orders.toLocaleString()}</td>
          <td>${c.last}</td>
          <td class="text-end">${fmtKWD(c.wallet)}</td>
        </tr>
      `).join('');
      body.innerHTML = rows;
      document.getElementById('rowsInfo').textContent = `Showing ${end - start} of ${DATA.length}`;
      document.getElementById('prevBtn').disabled = (page === 0);
      document.getElementById('nextBtn').disabled = (end >= DATA.length);
    }

    document.getElementById('prevBtn').addEventListener('click', ()=>{ if(page>0){page--; render();} });
    document.getElementById('nextBtn').addEventListener('click', ()=>{ if((page+1)*size<DATA.length){page++; render();} });

    render();
  </script>
    </body>
</html>