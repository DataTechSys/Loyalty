<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Messages · Loyalty Console</title>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link href="css/style.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    </head>
    <body>
        <div class="layout">
            <aside class="sidebar" id="sidebar">
                <div class="sb-brand">
                    <img src="images/DataTech.png" alt="DataTech">
                    <span class="brand-text">Loyalty Console</span>
                </div>
                <nav class="sb-nav"><a class="sb-link" href="dashboard.html"><i class="fa-solid fa-gauge-high"></i><span class="sb-text">Dashboard</span></a><a class="sb-link" href="orders.html"><i class="fa-solid fa-cart-shopping"></i><span class="sb-text">Orders</span></a><a class="sb-link" href="members.html"><i class="fa-solid fa-users"></i><span class="sb-text">Customers</span></a><a class="sb-link active" href="messages.html"><i class="fa-solid fa-paper-plane"></i><span class="sb-text">Messages</span></a><a class="sb-link" href="reports.html"><i class="fa-solid fa-chart-line"></i><span class="sb-text">Reports</span></a><a class="sb-link" href="settings.html"><i class="fa-solid fa-gear"></i><span class="sb-text">Settings</span></a><a class="sb-link" href="admin.html"><i class="fa-solid fa-user-shield"></i><span class="sb-text">Admin</span></a><a class="sb-link" href="login.html"><i class="fa-solid fa-right-to-bracket"></i><span class="sb-text">Login</span></a>
                </nav>
                <div class="sb-footer">© DataTech</div>
            </aside>
            <div class="main">
                <header class="dt-topbar">
                    <div class="tb-inner container d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center gap-2">
                            <button class="btn-icon burger" id="burger" aria-label="Toggle menu">☰</button>
                            <button class="btn-icon" id="collapseBtn" aria-label="Collapse sidebar">
                                <i class="fa-solid fa-bars"></i>
                            </button>
                        </div>
                        <div class="dt-brand">
                            <img src="images/DataTech.png" alt="DataTech">
                            <span>Loyalty Console</span>
                        </div>
                        <div class="d-flex align-items-center gap-2"></div>
                    </div>
                </header>
                <main class="page">
                    <div class="container-narrow">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div>
                                <h1 class="h5 fw-bold mb-0">Messages</h1>
                                <div class="text-muted small">Create and send push/SMS via PassKit</div>
                            </div>
                            <div class="d-flex gap-2">
                                <button class="btn btn-primary btn-sm" id="btnNew">
                                    <i class="fa-solid fa-plus me-1"></i>New Campaign
                                </button>
                            </div>
                        </div>
                        <div class="row g-2">
                            <div class="col-12 col-lg-5">
                                <div class="dt-card p-card h-100">
                                    <h2 class="h6 mb-2">Compose</h2>
                                    <form class="row g-2" id="msgForm">
                                        <div class="col-12">
                                            <label class="form-label small">Title</label>
                                            <input class="form-control" id="msgTitle" placeholder="Weekend offer">
                                        </div>
                                        <div class="col-12">
                                            <label class="form-label small">Message</label>
                                            <textarea class="form-control" id="msgBody" rows="5" placeholder="Your message text…"></textarea>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <label class="form-label small">Audience</label>
                                            <select class="form-select" id="msgAudience">
                                                <option value="all">All Members</option>
                                                <option value="active30">Active last 30 days</option>
                                                <option value="inactive30">Inactive 30+ days</option>
                                                <option value="highValue">High Value</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <label class="form-label small">Channel</label>
                                            <select class="form-select" id="msgChannel">
                                                <option value="passkit">PassKit Push</option>
                                                <option value="sms">SMS</option>
                                            </select>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <label class="form-label small">Schedule</label>
                                            <input type="datetime-local" id="msgWhen" class="form-control">
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <label class="form-label small">UTM / Tag (optional)</label>
                                            <input class="form-control" id="msgTag" placeholder="summer-25">
                                        </div>
                                        <div class="col-12 d-grid">
                                            <button class="btn btn-primary" type="submit">Queue Message</button>
                                        </div>
                                    </form>
                                    <div class="alert alert-success d-none mt-2" id="msgOK">Queued (demo).</div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-7">
                                <div class="dt-card p-card h-100">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Recent Campaigns</h2>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table align-middle mb-0" id="msgTable">
                                            <thead>
                                                <tr>
                                                    <th>Title</th>
                                                    <th>Audience</th>
                                                    <th>Channel</th>
                                                    <th class="text-end">Scheduled</th>
                                                    <th class="text-end">Status</th>
                                                </tr>
                                            </thead>
                                            <tbody id="msgBodyRows">
                                                <!-- injected -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/app-user.js"></script>
        <script>
    (function(){
      try{
        if (window.UserSession && !window.UserSession.isAuthenticated()){
          sessionStorage.setItem('redirectAfterLogin','messages.html'); location.replace('login.html'); return;
        }
      }catch(_){}
      const sidebar=document.getElementById('sidebar');
      document.getElementById('burger')?.addEventListener('click',()=> sidebar.classList.toggle('open'));
      document.getElementById('collapseBtn')?.addEventListener('click',()=> sidebar.classList.toggle('collapsed'));
      sidebar.querySelectorAll('a.sb-link').forEach(a=>a.addEventListener('click',()=> sidebar.classList.remove('open')));

      const CAMPAIGNS = [
        {title:'July Push', audience:'All', channel:'PassKit', when:'2025-07-30T10:00:00Z', status:'Sent'},
        {title:'Inactive Nudge', audience:'Inactive 30+ days', channel:'SMS', when:'2025-08-10T16:30:00Z', status:'Queued'}
      ];
      const fmt = d => new Date(d).toLocaleString([], { year:'numeric', month:'short', day:'2-digit', hour:'2-digit', minute:'2-digit' });

      function render(){
        document.getElementById('msgBodyRows').innerHTML = CAMPAIGNS.map(c => `
          <tr>
            <td class="fw-semibold">${c.title}</td>
            <td>${c.audience}</td>
            <td>${c.channel}</td>
            <td class="text-end">${fmt(c.when)}</td>
            <td class="text-end"><span class="badge text-bg-${c.status==='Sent'?'success':'warning'}">${c.status}</span></td>
          </tr>
        `).join('');
      }
      render();

      document.getElementById('msgForm').addEventListener('submit', (e)=>{
        e.preventDefault();
        const title = document.getElementById('msgTitle').value.trim();
        const body  = document.getElementById('msgBody').value.trim();
        const audience = document.getElementById('msgAudience').value;
        const channel  = document.getElementById('msgChannel').value.toUpperCase().slice(0,1)+document.getElementById('msgChannel').value.slice(1);
        const when = document.getElementById('msgWhen').value || new Date().toISOString();
        if(!title || !body){ alert('Title and message are required.'); return; }
        CAMPAIGNS.unshift({ title, audience, channel, when, status:'Queued' });
        render();
        e.target.reset();
        const ok = document.getElementById('msgOK'); ok.classList.remove('d-none'); setTimeout(()=>ok.classList.add('d-none'), 1500);
      });

      document.getElementById('btnNew').addEventListener('click', ()=>{
        document.getElementById('msgTitle').focus();
      });
    })();
  </script>
    </body>
</html>