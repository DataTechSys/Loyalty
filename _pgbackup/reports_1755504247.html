<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width,initial-scale=1"/>
        <title>Reports · Loyalty Console</title>
        <!-- Fonts / Bootstrap / Icons -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <!-- App styles -->
        <link rel="icon" type="image/x-icon" href="images/datatech-ico.ico">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/sidebar.css">
        <!-- Chart.js -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    </head>
    <!-- Full‑width layout -->
    <body class="fullpage">
        <div class="layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar" data-include="partials/sidebar.html"></aside>
            <!-- Main -->
            <div class="main">
                <!-- Topbar -->
                <div data-include="partials/topbar.html"></div>
                <!-- Page -->
                <main class="page">
                    <div class="container-narrow">
                        <!-- full width because of .fullpage -->
                        <!-- Title + filters -->
                        <div class="d-flex align-items-start justify-content-between mb-2">
                            <div>
                                <h1 class="h5 fw-bold mb-0">Reports</h1>
                                <div class="text-muted small">Sales, orders, payments, and loyalty performance</div>
                            </div>
                        </div>
                        <!-- Filters row -->
                        <div class="d-flex flex-wrap align-items-center gap-2 mb-2 filters-row">
                            <select class="form-select form-select-sm" id="flBranch">
                                <option selected>All Branches</option>
                                <option>Abu Halifa</option>
                                <option>Salmiya</option>
                                <option>Ardiya</option>
                            </select>
                            <select class="form-select form-select-sm" id="flRange">
                                <option>Last 7 days</option>
                                <option selected>Last 30 days</option>
                                <option>Last 90 days</option>
                                <option>This month</option>
                                <option>Last month</option>
                                <option>This year</option>
                            </select>
                            <div class="ms-auto d-flex gap-2">
                                <button class="btn btn-outline-secondary btn-sm" id="btnExport">
                                    <i class="fa-solid fa-file-export me-1"></i>Export
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" id="btnReset">
                                    <i class="fa-solid fa-rotate-right me-1"></i>Reset
                                </button>
                                <button class="btn btn-outline-secondary btn-sm" id="btnFilter">
                                    <i class="fa-solid fa-filter me-1"></i>Filter
                                </button>
                            </div>
                        </div>
                        <!-- Row 1: Revenue + Orders -->
                        <div class="row g-2">
                            <div class="col-12 col-xl-7">
                                <div class="dt-card p-card chart-tile">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Revenue (90 days)</h2>
                                    </div>
                                    <canvas id="repRevenue"></canvas>
                                </div>
                            </div>
                            <div class="col-12 col-xl-5">
                                <div class="dt-card p-card chart-tile">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Orders (90 days)</h2>
                                    </div>
                                    <canvas id="repOrders"></canvas>
                                </div>
                            </div>
                        </div>
                        <!-- Row 2: Payments + Members -->
                        <div class="row g-2 mt-2">
                            <div class="col-12 col-lg-5">
                                <div class="dt-card p-card chart-tile">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Payments Breakdown</h2>
                                    </div>
                                    <canvas id="repPayments"></canvas>
                                </div>
                            </div>
                            <div class="col-12 col-lg-7">
                                <div class="dt-card p-card chart-tile">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">New Members (90 days)</h2>
                                    </div>
                                    <canvas id="repMembers"></canvas>
                                </div>
                            </div>
                        </div>
                        <!-- Row 3: Redemptions + mini table -->
                        <div class="row g-2 mt-2">
                            <div class="col-12 col-lg-6">
                                <div class="dt-card p-card chart-tile">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Redemptions (90 days)</h2>
                                    </div>
                                    <canvas id="repRedemptions"></canvas>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6">
                                <div class="dt-card p-card h-100">
                                    <div class="d-flex align-items-center justify-content-between mb-1">
                                        <h2 class="h6 mb-0">Top Customers (demo)</h2>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table align-middle mb-0">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th class="text-end">Orders</th>
                                                    <th class="text-end">Spent (KWD)</th>
                                                </tr>
                                            </thead>
                                            <tbody id="repTopCust"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/dt-include.js"></script>
        <script src="js/sidebar.js" defer></script>
        <script src="js/app-user.js" defer></script>
        <script>
  (function(){
    // ---- Demo data (replace with API later) --------------------------------
    const DAYS = 90;

    // Labels (90 days)
    const labels = Array.from({length:DAYS}, (_,i)=>{
      const d=new Date(); d.setDate(d.getDate()-(DAYS-1-i));
      return d.toLocaleDateString([],{month:'short',day:'2-digit'});
    });

    // Helper to synthesize series
    function gen(n, base, jitter){
      const out=[]; for(let i=0;i<n;i++){
        out.push(Math.max(0, base + (Math.sin(i/5)*base*0.07) + (Math.random()-0.5)*jitter));
      } return out;
    }

    const revenue = gen(DAYS, 300, 95).map(v=>+v.toFixed(2));
    const orders  = gen(DAYS,  95, 30).map(v=>Math.round(v));
    const members = gen(DAYS,   8,  4).map(v=>Math.max(0,Math.round(v)));
    const redemp  = gen(DAYS,  20,  9).map(v=>Math.max(0,Math.round(v)));

    const common = {
      responsive:true,
      maintainAspectRatio:false,
      plugins:{ legend:{ display:false } },
      scales:{ y:{ beginAtZero:true, ticks:{ precision:0 } } }
    };

    // Revenue (line, fill)
    new Chart(document.getElementById('repRevenue'), {
      type:'line',
      data:{ labels, datasets:[{ label:'Revenue', data:revenue, fill:true, tension:.35 }] },
      options: common
    });

    // Orders (bar)
    new Chart(document.getElementById('repOrders'), {
      type:'bar',
      data:{ labels, datasets:[{ label:'Orders', data:orders }] },
      options: common
    });

    // Payments breakdown
    const payLabels = ['Knet','Apple Pay','Cash','Card','Loyalty'];
    const payData   = [44, 22, 16, 11, 7];
    new Chart(document.getElementById('repPayments'),{
      type:'doughnut',
      data:{ labels: payLabels, datasets:[{ data: payData }] },
      options:{ responsive:true, maintainAspectRatio:false, plugins:{ legend:{ position:'bottom' } }, cutout:'60%' }
    });

    // New members (line)
    new Chart(document.getElementById('repMembers'), {
      type:'line',
      data:{ labels, datasets:[{ label:'New Members', data:members, fill:true, tension:.35 }] },
      options: common
    });

    // Redemptions (bar)
    new Chart(document.getElementById('repRedemptions'), {
      type:'bar',
      data:{ labels, datasets:[{ label:'Redemptions', data:redemp }] },
      options: common
    });

    // Top customers (demo)
    const top = [
      { name:'Mustafa', orders:42, spent:  98.750 },
      { name:'Reem',    orders:31, spent:  81.200 },
      { name:'Ali',     orders:29, spent:  73.950 },
      { name:'Maryam',  orders:25, spent:  66.300 },
      { name:'Omar',    orders:24, spent:  64.150 }
    ];
    const fmtKWD = v => 'KWD ' + Number(v||0).toLocaleString(undefined,{minimumFractionDigits:3, maximumFractionDigits:3});
    document.getElementById('repTopCust').innerHTML = top.map(r=>`
      <tr>
        <td>${r.name}</td>
        <td class="text-end">${r.orders}</td>
        <td class="text-end">${fmtKWD(r.spent)}</td>
      </tr>
    `).join('');

    // Buttons (demo wiring)
    document.getElementById('btnReset').addEventListener('click', ()=>{
      document.getElementById('flBranch').selectedIndex = 0;
      document.getElementById('flRange').selectedIndex  = 1; // Last 30 days
    });
    document.getElementById('btnExport').addEventListener('click', ()=>{
      alert('Export CSV / PDF (demo)');
    });
    document.getElementById('btnFilter').addEventListener('click', ()=>{
      alert('Open advanced filter (demo)');
    });
  })();
  </script>
    </body>
</html>