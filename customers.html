<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <title>Customers · Loyalty Console</title>
        <!-- Fonts + Bootstrap + Icons -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
        <link rel="icon" type="image/x-icon" href="images/datatech-ico.ico">
        <!-- Project styles -->
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/sidebar.css">
        <style>
      /* ===========================
         Customers page (scoped styles)
         =========================== */
      .customers-page .toolbar {
        gap:.5rem; align-items:center; padding:.25rem 0 .5rem;
      }
      .customers-page .toolbar .form-select,
      .customers-page .toolbar .form-control{
        height:32px; padding:.25rem .5rem; font-size:.9rem; line-height:1.1;
      }
      .customers-page .toolbar .btn{
        --bs-btn-padding-y:.25rem; --bs-btn-padding-x:.5rem; --bs-btn-font-size:.9rem;
        height:32px;
      }

      .customers-page .table{
        --cell-y: .4rem;
        font-size:.92rem;
      }
      .customers-page .table thead th{
        text-transform:uppercase; letter-spacing:.04em; font-size:.74rem; color:#6b7280;
        border-top:0;
      }
      .customers-page .table > :not(caption) > * > *{
        padding-top:var(--cell-y); padding-bottom:var(--cell-y);
        border-color:var(--dt-border);
      }

      .customers-page .tier-pill{
        display:inline-flex; align-items:center; gap:.35rem;
        border:1px solid #c7d2fe; background:#eef2ff; color:#3730a3;
        border-radius:999px; padding:.15rem .5rem; font-weight:700; font-size:.72rem;
      }
      .customers-page .tier-gold{
        border-color:#fde68a; background:#fffbeb; color:#92400e;
      }
      .customers-page .tier-silver{
        border-color:#e5e7eb; background:#f9fafb; color:#374151;
      }
      .customers-page .tier-bronze{
        border-color:#fcd34d; background:#fff7ed; color:#7c2d12;
      }

      .customers-page .money{ white-space:nowrap; }
      .customers-page .cell-customer small{ color:#6b7280; display:block; line-height:1.15; }
      .customers-page .dt-card{ padding:12px 14px; }
      .customers-page .pager{ color:#6b7280; }
    </style>
    </head>
    <body class="fullpage">
        <div class="layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar" data-include="partials/sidebar.html"></aside>
            <!-- Main -->
            <div class="main">
                <!-- Topbar -->
                <div data-include="partials/topbar.html"></div>
                <!-- Page -->
                <main class="page customers-page">
                    <div class="container-narrow">
                        <h1 class="h6 fw-bold mb-2">Customers</h1>
                        <div class="dt-card p-card">
                            <!-- Toolbar -->
                            <div class="d-flex flex-wrap toolbar">
                                <select id="filterBranch" class="form-select" style="max-width:220px">
                                    <option value="">All Branches</option>
                                    <option>AHB | Abu Halifa</option>
                                    <option>SLB | Salmiya</option>
                                    <option>JRB | Jahra</option>
                                    <option>ADB | Ardiya</option>
                                </select>
                                <select id="filterTier" class="form-select" style="max-width:160px">
                                    <option value="">All Tiers</option>
                                    <option>Gold</option>
                                    <option>Silver</option>
                                    <option>Bronze</option>
                                </select>
                                <input id="filterQuery" type="search" class="form-control" style="max-width:260px" placeholder="Search name, phone, or email">
                                <input id="filterJoinedAfter" type="date" class="form-control" style="max-width:160px" title="Joined After">
                                <div class="ms-auto d-flex gap-2">
                                    <button id="btnExport" class="btn btn-outline-secondary"><i class="fa-solid fa-file-export me-1"></i>Export
                                    </button>
                                    <button id="btnRefresh" class="btn btn-outline-secondary"><i class="fa-solid fa-rotate me-1"></i>Refresh
                                    </button>
                                    <button id="btnFilter" class="btn btn-outline-secondary"><i class="fa-solid fa-filter me-1"></i>Filter
                                    </button>
                                </div>
                            </div>
                            <!-- Table -->
                            <div class="table-responsive">
                                <table class="table align-middle mb-0">
                                    <thead>
                                        <tr>
                                            <th style="width:26px;"></th>
                                            <th>Customer</th>
                                            <th>Branch</th>
                                            <th>Tier</th>
                                            <th class="text-end">Points</th>
                                            <th class="text-end">Orders</th>
                                            <th class="text-end">Spent</th>
                                            <th>Joined At</th>
                                            <th>Last Order</th>
                                        </tr>
                                    </thead>
                                    <tbody id="customersBody"></tbody>
                                </table>
                            </div>
                            <!-- Pager -->
                            <div class="d-flex justify-content-between align-items-center mt-2 small pager">
                                <div id="pagerText">Showing 1 to 10 of 10</div>
                                <div class="d-flex gap-2">
                                    <button class="btn btn-outline-secondary btn-sm" disabled>Previous</button>
                                    <button class="btn btn-outline-secondary btn-sm" disabled>Next</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <!-- JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
        <script src="js/dt-include.js"></script>
        <script src="js/sidebar.js" defer></script>
        <script src="js/app-user.js" defer></script>
        <script>
      (function(){
        // --- Demo dataset (replace with API data later) ---
        const ROWS = [
          { id:1,  name:"Mustafa Ahmed", email:"mustafa@example.com", phone:"6586 1990", branch:"AHB | Abu Halifa", tier:"Gold",   points:1650, orders:42, spent:98.750,  joined:"2024-11-05", last:"2025-08-16 15:32" },
          { id:2,  name:"Reem Al-Harbi", email:"reem@domain.com",     phone:"",         branch:"ADB | Ardiya",     tier:"Silver", points:820,  orders:31, spent:81.200,  joined:"2025-02-14", last:"2025-08-16 15:29" },
          { id:3,  name:"Ali Saleh",     email:"ali@domain.com",      phone:"6633 1534",branch:"SLB | Salmiya",    tier:"Bronze", points:260,  orders:29, spent:73.950,  joined:"2024-09-22", last:"2025-08-16 15:28" },
          { id:4,  name:"Maryam Y.",     email:"maryam@example.com",  phone:"6616 7722",branch:"JRB | Jahra",      tier:"Silver", points:590,  orders:25, spent:66.300,  joined:"2025-04-18", last:"2025-08-16 15:23" },
          { id:5,  name:"Omar N.",       email:"omar@example.com",    phone:"",         branch:"SLB | Salmiya",    tier:"Gold",   points:1410, orders:24, spent:64.150,  joined:"2024-12-03", last:"2025-08-16 15:20" },
          { id:6,  name:"Fuad M. Al-Ghazali", email:"fuad@domain.com",phone:"588 81127",branch:"SLB | Salmiya",   tier:"Silver", points:470,  orders:18, spent:41.750,  joined:"2025-03-09", last:"2025-08-16 15:18" },
          { id:7,  name:"Dana B.",       email:"dana@example.com",    phone:"6600 4908",branch:"AHB | Abu Halifa", tier:"Bronze", points:120,  orders:12, spent:22.250,  joined:"2025-05-25", last:"2025-08-16 15:18" },
          { id:8,  name:"Bader",         email:"bader@domain.com",    phone:"",         branch:"JRB | Jahra",      tier:"Bronze", points:85,   orders:9,  spent:11.950,  joined:"2025-07-11", last:"2025-08-16 15:23" },
          { id:9,  name:"No Name",       email:"",                    phone:"",         branch:"SLB | Salmiya",    tier:"Silver", points:310,  orders:14, spent:19.200,  joined:"2025-01-06", last:"2025-08-16 15:21" },
          { id:10, name:"Guest",         email:"guest@domain.com",    phone:"",         branch:"ADB | Ardiya",     tier:"Gold",   points:990,  orders:20, spent:35.600,  joined:"2024-10-28", last:"2025-08-16 15:29" }
        ];

        const elBody   = document.getElementById('customersBody');
        const elBranch = document.getElementById('filterBranch');
        const elTier   = document.getElementById('filterTier');
        const elQuery  = document.getElementById('filterQuery');
        const elAfter  = document.getElementById('filterJoinedAfter');
        const elPager  = document.getElementById('pagerText');

        const fmtKWD = v => 'KWD ' + Number(v||0).toLocaleString(undefined,{minimumFractionDigits:3, maximumFractionDigits:3});
        const fmtPts = v => Number(v||0).toLocaleString(undefined);
        const tierPill = t => {
          const cls = t ? t.toLowerCase() : '';
          const extra =
            cls === 'gold'   ? ' tier-gold'   :
            cls === 'silver' ? ' tier-silver' :
            cls === 'bronze' ? ' tier-bronze' : '';
          return `<span class="tier-pill${extra}">${t||'—'}</span>`;
        };

       function cellCustomer(r){
  const lines = [];
  lines.push(`<a href="customer-details.html" class="text-decoration-none fw-semibold">${r.name || '—'}</a>`);
  const meta = [r.phone, r.email].filter(Boolean).join(" · ");
  if (meta) lines.push(`<small>${meta}</small>`);
  return `<div class="cell-customer">${lines.join("")}</div>`;
}

        function row(r){
          return `
            <tr>
              <td><input type="checkbox" aria-label="select row"></td>
              <td>${cellCustomer(r)}</td>
              <td>${r.branch||'—'}</td>
              <td>${tierPill(r.tier)}</td>
              <td class="text-end">${fmtPts(r.points)}</td>
              <td class="text-end">${r.orders||0}</td>
              <td class="text-end money">${fmtKWD(r.spent)}</td>
              <td>${r.joined||'—'}</td>
              <td>${r.last||'—'}</td>
            </tr>`;
        }

        function passesFilters(r){
          const b = elBranch.value;
          const t = elTier.value;
          const q = (elQuery.value||'').trim().toLowerCase();
          const a = elAfter.value;

          if (b && r.branch !== b) return false;
          if (t && (r.tier||'') !== t) return false;

          if (q){
            const hay = [r.name, r.email, r.phone].filter(Boolean).join(' ').toLowerCase();
            if (!hay.includes(q)) return false;
          }
          if (a){
            try {
              const dJoin = new Date(r.joined);
              const dCut  = new Date(a);
              if (!(dJoin instanceof Date) || isNaN(dJoin)) return false;
              if (dJoin < dCut) return false;
            } catch(_){ return false; }
          }
          return true;
        }

        function render(){
          const data = ROWS.filter(passesFilters);
          elBody.innerHTML = data.map(row).join('');
          elPager.textContent = `Showing 1 to ${data.length} of ${data.length}`;
        }

        // Actions
        elBranch.addEventListener('change', render);
        elTier.addEventListener('change', render);
        elQuery.addEventListener('input', ()=>{ /* debounce not necessary here */ render(); });
        elAfter.addEventListener('change', render);

        document.getElementById('btnRefresh').addEventListener('click', ()=>{
          elBranch.value = '';
          elTier.value = '';
          elQuery.value = '';
          elAfter.value = '';
          render();
        });

        document.getElementById('btnFilter').addEventListener('click', ()=>{
          elQuery.focus();
        });

        document.getElementById('btnExport').addEventListener('click', ()=>{
          // Export filtered rows to CSV
          const data = ROWS.filter(passesFilters);
          const header = ['Name','Email','Phone','Branch','Tier','Points','Orders','Spent','Joined At','Last Order'];
          const lines = [header.join(',')].concat(
            data.map(r => [
              r.name, r.email, r.phone, r.branch, r.tier, r.points, r.orders, r.spent, r.joined, r.last
            ].map(x=>`"${String(x??'').replace(/"/g,'""')}"`).join(','))
          );
          const blob = new Blob([lines.join('\n')], {type:'text/csv;charset=utf-8;'});
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a'); a.href=url; a.download='customers.csv';
          document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
        });

        render();
      })();
    </script>
    </body>
</html>